
> @money-wise/web@0.1.0 test:unit /home/nemesi/dev/money-wise/apps/web
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v1.6.1 /home/nemesi/dev/money-wise/apps/web

[90m18:15:07:697[0m [34m[websocket][0m constructing the interceptor...
[90m18:15:07:752[0m [34m[client-request-interceptor][0m constructing the interceptor...
[90m18:15:07:753[0m [34m[xhr][0m constructing the interceptor...
[90m18:15:07:753[0m [34m[fetch][0m constructing the interceptor...
[90m18:15:07:753[0m [34m[setup-server][0m constructing the interceptor...
[90m18:15:07:756[0m [34m[setup-server:apply][0m applying the interceptor...
[90m18:15:07:756[0m [34m[setup-server][0m retrieved global instance: undefined
[90m18:15:07:756[0m [34m[setup-server:apply][0m no running instance found, setting up a new instance...
[90m18:15:07:756[0m [34m[setup-server:setup][0m applying all 3 interceptors...
[90m18:15:07:757[0m [34m[setup-server:setup][0m applying "_ClientRequestInterceptor" interceptor...
[90m18:15:07:757[0m [34m[client-request-interceptor:apply][0m applying the interceptor...
[90m18:15:07:757[0m [34m[client-request-interceptor][0m retrieved global instance: undefined
[90m18:15:07:757[0m [34m[client-request-interceptor:apply][0m no running instance found, setting up a new instance...
[90m18:15:07:757[0m [34m[client-request-interceptor][0m set global instance! client-request-interceptor
[90m18:15:07:757[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m18:15:07:757[0m [34m[setup-server:setup][0m applying "_XMLHttpRequestInterceptor" interceptor...
[90m18:15:07:757[0m [34m[xhr:apply][0m applying the interceptor...
[90m18:15:07:757[0m [34m[xhr][0m retrieved global instance: undefined
[90m18:15:07:758[0m [34m[xhr:apply][0m no running instance found, setting up a new instance...
[90m18:15:07:758[0m [34m[xhr:setup][0m patching "XMLHttpRequest" module...
[90m18:15:07:758[0m [34m[xhr:setup][0m native "XMLHttpRequest" module patched! XMLHttpRequest
[90m18:15:07:758[0m [34m[xhr][0m set global instance! xhr
[90m18:15:07:758[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m18:15:07:758[0m [34m[setup-server:setup][0m applying "_FetchInterceptor" interceptor...
[90m18:15:07:758[0m [34m[fetch:apply][0m applying the interceptor...
[90m18:15:07:758[0m [34m[fetch][0m retrieved global instance: undefined
[90m18:15:07:758[0m [34m[fetch:apply][0m no running instance found, setting up a new instance...
[90m18:15:07:758[0m [34m[fetch][0m set global instance! fetch
[90m18:15:07:758[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m18:15:07:758[0m [34m[setup-server][0m set global instance! setup-server
[90m18:15:07:758[0m [34m[client-request-interceptor:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m18:15:07:758[0m [34m[xhr:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m18:15:07:758[0m [34m[fetch:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m18:15:07:758[0m [34m[client-request-interceptor:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m18:15:07:758[0m [34m[xhr:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m18:15:07:758[0m [34m[fetch:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m18:15:07:758[0m [34m[client-request-interceptor:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m18:15:07:758[0m [34m[xhr:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m18:15:07:759[0m [34m[fetch:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m18:15:07:759[0m [34m[websocket:on][0m adding "connection" event listener: async (connection) => {
    const handlers = options.getHandlers().filter(isHandlerKind("EventHandler"));
    if (handlers.length > 0) {
      options?.onMockedConnection(connection);
      await Promise.all(
        handlers.map((handler) => {
          return handler.run(connection);
        })
      );
      return;
    }
    const request = new Request(connection.client.url, {
      headers: {
        upgrade: "websocket",
        connection: "upgrade"
      }
    });
    await onUnhandledRequest(
      request,
      options.getUnhandledRequestStrategy()
    ).catch((error) => {
      const errorEvent = new Event("error");
      Object.defineProperty(errorEvent, "cause", {
        enumerable: true,
        configurable: false,
        value: error
      });
      connection.client.socket.dispatchEvent(errorEvent);
    });
    options?.onPassthroughConnection(connection);
    connection.server.connect();
  }
[90m18:15:07:759[0m [34m[websocket:apply][0m applying the interceptor...
[90m18:15:07:759[0m [34m[websocket][0m retrieved global instance: undefined
[90m18:15:07:759[0m [34m[websocket:apply][0m no running instance found, setting up a new instance...
[90m18:15:07:759[0m [34m[websocket][0m set global instance! websocket
[90m18:15:07:765[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m18:15:07:765[0m [34m[fetch][0m awaiting for the mocked response...
[90m18:15:07:765[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m18:15:07:790[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m18:15:07:791[0m [34m[fetch][0m emitting the "response" event...
[90m18:15:07:791[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m18:15:07:797[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m18:15:07:797[0m [34m[fetch][0m awaiting for the mocked response...
[90m18:15:07:797[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m18:15:07:801[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m18:15:07:801[0m [34m[fetch][0m emitting the "response" event...
[90m18:15:07:801[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m18:15:07:802[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/register
[90m18:15:07:802[0m [34m[fetch][0m awaiting for the mocked response...
[90m18:15:07:802[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m18:15:07:808[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m18:15:07:808[0m [34m[fetch][0m emitting the "response" event...
[90m18:15:07:808[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m18:15:07:810[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m18:15:07:810[0m [34m[fetch][0m awaiting for the mocked response...
[90m18:15:07:810[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m18:15:07:812[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m18:15:07:812[0m [34m[fetch][0m emitting the "response" event...
[90m18:15:07:812[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m18:15:07:813[0m [34m[setup-server:dispose][0m disposing the interceptor...
[90m18:15:07:813[0m [34m[setup-server][0m retrieved global instance: BatchInterceptor
[90m18:15:07:813[0m [34m[setup-server][0m cleared global instance! setup-server
[90m18:15:07:813[0m [34m[setup-server:dispose][0m global symbol deleted: undefined
[90m18:15:07:813[0m [34m[setup-server:dispose][0m disposing of 3 subscriptions...
[90m18:15:07:813[0m [34m[client-request-interceptor:dispose][0m disposing the interceptor...
[90m18:15:07:813[0m [34m[client-request-interceptor][0m retrieved global instance: _ClientRequestInterceptor
[90m18:15:07:813[0m [34m[client-request-interceptor][0m cleared global instance! client-request-interceptor
[90m18:15:07:813[0m [34m[client-request-interceptor:dispose][0m global symbol deleted: undefined
[90m18:15:07:813[0m [34m[client-request-interceptor:dispose][0m disposing of 1 subscriptions...
[90m18:15:07:813[0m [34m[client-request-interceptor:dispose][0m disposed of all subscriptions! 0
[90m18:15:07:813[0m [34m[client-request-interceptor:dispose][0m destroyed the listener!
[90m18:15:07:813[0m [34m[xhr:dispose][0m disposing the interceptor...
[90m18:15:07:813[0m [34m[xhr][0m retrieved global instance: _XMLHttpRequestInterceptor
[90m18:15:07:813[0m [34m[xhr][0m cleared global instance! xhr
[90m18:15:07:813[0m [34m[xhr:dispose][0m global symbol deleted: undefined
[90m18:15:07:813[0m [34m[xhr:dispose][0m disposing of 1 subscriptions...
[90m18:15:07:814[0m [34m[xhr:setup][0m native "XMLHttpRequest" module restored! XMLHttpRequest
[90m18:15:07:814[0m [34m[xhr:dispose][0m disposed of all subscriptions! 0
[90m18:15:07:814[0m [34m[xhr:dispose][0m destroyed the listener!
[90m18:15:07:814[0m [34m[fetch:dispose][0m disposing the interceptor...
[90m18:15:07:814[0m [34m[fetch][0m retrieved global instance: _FetchInterceptor
[90m18:15:07:814[0m [34m[fetch][0m cleared global instance! fetch
[90m18:15:07:814[0m [34m[fetch:dispose][0m global symbol deleted: undefined
[90m18:15:07:814[0m [34m[fetch:dispose][0m disposing of 1 subscriptions...
[90m18:15:07:814[0m [34m[fetch][0m restored native "globalThis.fetch"! fetch
[90m18:15:07:814[0m [34m[fetch:dispose][0m disposed of all subscriptions! 0
[90m18:15:07:814[0m [34m[fetch:dispose][0m destroyed the listener!
[90m18:15:07:814[0m [34m[setup-server:dispose][0m disposed of all subscriptions! 0
[90m18:15:07:814[0m [34m[setup-server:dispose][0m destroyed the listener!
[90m18:15:07:814[0m [34m[websocket:dispose][0m disposing the interceptor...
[90m18:15:07:814[0m [34m[websocket][0m retrieved global instance: _WebSocketInterceptor
[90m18:15:07:814[0m [34m[websocket][0m cleared global instance! websocket
[90m18:15:07:814[0m [34m[websocket:dispose][0m global symbol deleted: undefined
[90m18:15:07:814[0m [34m[websocket:dispose][0m disposing of 1 subscriptions...
[90m18:15:07:814[0m [34m[websocket:dispose][0m disposed of all subscriptions! 0
[90m18:15:07:814[0m [34m[websocket:dispose][0m destroyed the listener!
 â¯ |@money-wise/web| __tests__/api/auth.test.tsx  (4 tests | 2 failed) 59ms
   â¯ __tests__/api/auth.test.tsx > Authentication API > should login with valid credentials
     â†’ expected undefined to be 'mock-jwt-token' // Object.is equality
   â¯ __tests__/api/auth.test.tsx > Authentication API > should register a new user
     â†’ expected undefined to be 'mock-jwt-token-new-user' // Object.is equality
 âœ“ |@money-wise/web| __tests__/pages/home.test.tsx  (4 tests) 217ms
 âœ“ |@money-wise/web| __tests__/components/ui/button.test.tsx  (9 tests) 457ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 2 â¯â¯â¯â¯â¯â¯â¯

 FAIL  |@money-wise/web| __tests__/api/auth.test.tsx > Authentication API > should login with valid credentials
AssertionError: expected undefined to be 'mock-jwt-token' // Object.is equality

- Expected: 
"mock-jwt-token"

+ Received: 
undefined

 â¯ __tests__/api/auth.test.tsx:26:24
     24|       fullName: expect.any(String),
     25|     });
     26|     expect(data.token).toBe('mock-jwt-token');
       |                        ^
     27|   });
     28| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯

 FAIL  |@money-wise/web| __tests__/api/auth.test.tsx > Authentication API > should register a new user
AssertionError: expected undefined to be 'mock-jwt-token-new-user' // Object.is equality

- Expected: 
"mock-jwt-token-new-user"

+ Received: 
undefined

 â¯ __tests__/api/auth.test.tsx:67:24
     65|       email: 'newuser@example.com',
     66|     });
     67|     expect(data.token).toBe('mock-jwt-token-new-user');
       |                        ^
     68|   });
     69| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/2]â¯

 Test Files  1 failed | 2 passed (3)
      Tests  2 failed | 15 passed (17)
   Start at  18:15:06
   Duration  1.94s (transform 154ms, setup 285ms, collect 773ms, tests 733ms, environment 1.43s, prepare 701ms)

â€‰ELIFECYCLEâ€‰ Command failed with exit code 1.
