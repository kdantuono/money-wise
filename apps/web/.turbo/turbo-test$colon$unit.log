
> @money-wise/web@0.1.0 test:unit /home/nemesi/dev/money-wise/apps/web
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v1.6.1 /home/nemesi/dev/money-wise/apps/web

[90m23:50:30:72[0m [34m[websocket][0m constructing the interceptor...
[90m23:50:30:177[0m [34m[client-request-interceptor][0m constructing the interceptor...
[90m23:50:30:177[0m [34m[xhr][0m constructing the interceptor...
[90m23:50:30:177[0m [34m[fetch][0m constructing the interceptor...
[90m23:50:30:178[0m [34m[setup-server][0m constructing the interceptor...
[90m23:50:30:183[0m [34m[setup-server:apply][0m applying the interceptor...
[90m23:50:30:183[0m [34m[setup-server][0m retrieved global instance: undefined
[90m23:50:30:183[0m [34m[setup-server:apply][0m no running instance found, setting up a new instance...
[90m23:50:30:183[0m [34m[setup-server:setup][0m applying all 3 interceptors...
[90m23:50:30:183[0m [34m[setup-server:setup][0m applying "_ClientRequestInterceptor" interceptor...
[90m23:50:30:184[0m [34m[client-request-interceptor:apply][0m applying the interceptor...
[90m23:50:30:184[0m [34m[client-request-interceptor][0m retrieved global instance: undefined
[90m23:50:30:184[0m [34m[client-request-interceptor:apply][0m no running instance found, setting up a new instance...
[90m23:50:30:184[0m [34m[client-request-interceptor][0m set global instance! client-request-interceptor
[90m23:50:30:184[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m23:50:30:184[0m [34m[setup-server:setup][0m applying "_XMLHttpRequestInterceptor" interceptor...
[90m23:50:30:184[0m [34m[xhr:apply][0m applying the interceptor...
[90m23:50:30:184[0m [34m[xhr][0m retrieved global instance: undefined
[90m23:50:30:184[0m [34m[xhr:apply][0m no running instance found, setting up a new instance...
[90m23:50:30:185[0m [34m[xhr:setup][0m patching "XMLHttpRequest" module...
[90m23:50:30:185[0m [34m[xhr:setup][0m native "XMLHttpRequest" module patched! XMLHttpRequest
[90m23:50:30:185[0m [34m[xhr][0m set global instance! xhr
[90m23:50:30:185[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m23:50:30:185[0m [34m[setup-server:setup][0m applying "_FetchInterceptor" interceptor...
[90m23:50:30:185[0m [34m[fetch:apply][0m applying the interceptor...
[90m23:50:30:185[0m [34m[fetch][0m retrieved global instance: undefined
[90m23:50:30:185[0m [34m[fetch:apply][0m no running instance found, setting up a new instance...
[90m23:50:30:185[0m [34m[fetch][0m set global instance! fetch
[90m23:50:30:185[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m23:50:30:185[0m [34m[setup-server][0m set global instance! setup-server
[90m23:50:30:185[0m [34m[client-request-interceptor:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m23:50:30:185[0m [34m[xhr:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m23:50:30:185[0m [34m[fetch:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m23:50:30:185[0m [34m[client-request-interceptor:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m23:50:30:185[0m [34m[xhr:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m23:50:30:186[0m [34m[fetch:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m23:50:30:186[0m [34m[client-request-interceptor:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m23:50:30:186[0m [34m[xhr:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m23:50:30:186[0m [34m[fetch:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m23:50:30:186[0m [34m[websocket:on][0m adding "connection" event listener: async (connection) => {
    const handlers = options.getHandlers().filter(isHandlerKind("EventHandler"));
    if (handlers.length > 0) {
      options?.onMockedConnection(connection);
      await Promise.all(
        handlers.map((handler) => {
          return handler.run(connection);
        })
      );
      return;
    }
    const request = new Request(connection.client.url, {
      headers: {
        upgrade: "websocket",
        connection: "upgrade"
      }
    });
    await onUnhandledRequest(
      request,
      options.getUnhandledRequestStrategy()
    ).catch((error) => {
      const errorEvent = new Event("error");
      Object.defineProperty(errorEvent, "cause", {
        enumerable: true,
        configurable: false,
        value: error
      });
      connection.client.socket.dispatchEvent(errorEvent);
    });
    options?.onPassthroughConnection(connection);
    connection.server.connect();
  }
[90m23:50:30:186[0m [34m[websocket:apply][0m applying the interceptor...
[90m23:50:30:186[0m [34m[websocket][0m retrieved global instance: undefined
[90m23:50:30:186[0m [34m[websocket:apply][0m no running instance found, setting up a new instance...
[90m23:50:30:186[0m [34m[websocket][0m set global instance! websocket
[90m23:50:30:196[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m23:50:30:196[0m [34m[fetch][0m awaiting for the mocked response...
[90m23:50:30:197[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m23:50:30:233[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m23:50:30:234[0m [34m[fetch][0m emitting the "response" event...
[90m23:50:30:234[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m23:50:30:239[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m23:50:30:239[0m [34m[fetch][0m awaiting for the mocked response...
[90m23:50:30:239[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m23:50:30:244[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m23:50:30:244[0m [34m[fetch][0m emitting the "response" event...
[90m23:50:30:245[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m23:50:30:247[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/register
[90m23:50:30:247[0m [34m[fetch][0m awaiting for the mocked response...
[90m23:50:30:247[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m23:50:30:256[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m23:50:30:257[0m [34m[fetch][0m emitting the "response" event...
[90m23:50:30:257[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m23:50:30:260[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m23:50:30:260[0m [34m[fetch][0m awaiting for the mocked response...
[90m23:50:30:260[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m23:50:30:262[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m23:50:30:262[0m [34m[fetch][0m emitting the "response" event...
[90m23:50:30:262[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m23:50:30:264[0m [34m[setup-server:dispose][0m disposing the interceptor...
[90m23:50:30:264[0m [34m[setup-server][0m retrieved global instance: BatchInterceptor
[90m23:50:30:264[0m [34m[setup-server][0m cleared global instance! setup-server
[90m23:50:30:264[0m [34m[setup-server:dispose][0m global symbol deleted: undefined
[90m23:50:30:264[0m [34m[setup-server:dispose][0m disposing of 3 subscriptions...
[90m23:50:30:264[0m [34m[client-request-interceptor:dispose][0m disposing the interceptor...
[90m23:50:30:264[0m [34m[client-request-interceptor][0m retrieved global instance: _ClientRequestInterceptor
[90m23:50:30:264[0m [34m[client-request-interceptor][0m cleared global instance! client-request-interceptor
[90m23:50:30:264[0m [34m[client-request-interceptor:dispose][0m global symbol deleted: undefined
[90m23:50:30:264[0m [34m[client-request-interceptor:dispose][0m disposing of 1 subscriptions...
[90m23:50:30:264[0m [34m[client-request-interceptor:dispose][0m disposed of all subscriptions! 0
[90m23:50:30:264[0m [34m[client-request-interceptor:dispose][0m destroyed the listener!
[90m23:50:30:264[0m [34m[xhr:dispose][0m disposing the interceptor...
[90m23:50:30:264[0m [34m[xhr][0m retrieved global instance: _XMLHttpRequestInterceptor
[90m23:50:30:264[0m [34m[xhr][0m cleared global instance! xhr
[90m23:50:30:264[0m [34m[xhr:dispose][0m global symbol deleted: undefined
[90m23:50:30:264[0m [34m[xhr:dispose][0m disposing of 1 subscriptions...
[90m23:50:30:264[0m [34m[xhr:setup][0m native "XMLHttpRequest" module restored! XMLHttpRequest
[90m23:50:30:264[0m [34m[xhr:dispose][0m disposed of all subscriptions! 0
[90m23:50:30:264[0m [34m[xhr:dispose][0m destroyed the listener!
[90m23:50:30:264[0m [34m[fetch:dispose][0m disposing the interceptor...
[90m23:50:30:265[0m [34m[fetch][0m retrieved global instance: _FetchInterceptor
[90m23:50:30:265[0m [34m[fetch][0m cleared global instance! fetch
[90m23:50:30:265[0m [34m[fetch:dispose][0m global symbol deleted: undefined
[90m23:50:30:265[0m [34m[fetch:dispose][0m disposing of 1 subscriptions...
[90m23:50:30:265[0m [34m[fetch][0m restored native "globalThis.fetch"! fetch
[90m23:50:30:265[0m [34m[fetch:dispose][0m disposed of all subscriptions! 0
[90m23:50:30:265[0m [34m[fetch:dispose][0m destroyed the listener!
[90m23:50:30:265[0m [34m[setup-server:dispose][0m disposed of all subscriptions! 0
[90m23:50:30:265[0m [34m[setup-server:dispose][0m destroyed the listener!
[90m23:50:30:265[0m [34m[websocket:dispose][0m disposing the interceptor...
[90m23:50:30:265[0m [34m[websocket][0m retrieved global instance: _WebSocketInterceptor
[90m23:50:30:265[0m [34m[websocket][0m cleared global instance! websocket
[90m23:50:30:265[0m [34m[websocket:dispose][0m global symbol deleted: undefined
[90m23:50:30:265[0m [34m[websocket:dispose][0m disposing of 1 subscriptions...
[90m23:50:30:265[0m [34m[websocket:dispose][0m disposed of all subscriptions! 0
[90m23:50:30:265[0m [34m[websocket:dispose][0m destroyed the listener!
 âœ“ |@money-wise/web| __tests__/api/auth.test.tsx  (4 tests) 83ms
 âœ“ |@money-wise/web| __tests__/pages/home.test.tsx  (4 tests) 463ms
 âœ“ |@money-wise/web| __tests__/components/ui/button.test.tsx  (9 tests) 842ms

 Test Files  3 passed (3)
      Tests  17 passed (17)
   Start at  23:50:27
   Duration  3.53s (transform 225ms, setup 490ms, collect 1.34s, tests 1.39s, environment 2.57s, prepare 1.71s)

