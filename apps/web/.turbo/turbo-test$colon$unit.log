
> @money-wise/web@0.1.0 test:unit /home/nemesi/dev/money-wise/apps/web
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v1.6.1 /home/nemesi/dev/money-wise/apps/web

[90m21:37:57:567[0m [34m[websocket][0m constructing the interceptor...
[90m21:37:57:622[0m [34m[client-request-interceptor][0m constructing the interceptor...
[90m21:37:57:622[0m [34m[xhr][0m constructing the interceptor...
[90m21:37:57:622[0m [34m[fetch][0m constructing the interceptor...
[90m21:37:57:623[0m [34m[setup-server][0m constructing the interceptor...
[90m21:37:57:629[0m [34m[setup-server:apply][0m applying the interceptor...
[90m21:37:57:629[0m [34m[setup-server][0m retrieved global instance: undefined
[90m21:37:57:629[0m [34m[setup-server:apply][0m no running instance found, setting up a new instance...
[90m21:37:57:629[0m [34m[setup-server:setup][0m applying all 3 interceptors...
[90m21:37:57:630[0m [34m[setup-server:setup][0m applying "_ClientRequestInterceptor" interceptor...
[90m21:37:57:630[0m [34m[client-request-interceptor:apply][0m applying the interceptor...
[90m21:37:57:630[0m [34m[client-request-interceptor][0m retrieved global instance: undefined
[90m21:37:57:630[0m [34m[client-request-interceptor:apply][0m no running instance found, setting up a new instance...
[90m21:37:57:630[0m [34m[client-request-interceptor][0m set global instance! client-request-interceptor
[90m21:37:57:630[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m21:37:57:630[0m [34m[setup-server:setup][0m applying "_XMLHttpRequestInterceptor" interceptor...
[90m21:37:57:630[0m [34m[xhr:apply][0m applying the interceptor...
[90m21:37:57:630[0m [34m[xhr][0m retrieved global instance: undefined
[90m21:37:57:630[0m [34m[xhr:apply][0m no running instance found, setting up a new instance...
[90m21:37:57:631[0m [34m[xhr:setup][0m patching "XMLHttpRequest" module...
[90m21:37:57:631[0m [34m[xhr:setup][0m native "XMLHttpRequest" module patched! XMLHttpRequest
[90m21:37:57:631[0m [34m[xhr][0m set global instance! xhr
[90m21:37:57:631[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m21:37:57:631[0m [34m[setup-server:setup][0m applying "_FetchInterceptor" interceptor...
[90m21:37:57:631[0m [34m[fetch:apply][0m applying the interceptor...
[90m21:37:57:631[0m [34m[fetch][0m retrieved global instance: undefined
[90m21:37:57:631[0m [34m[fetch:apply][0m no running instance found, setting up a new instance...
[90m21:37:57:631[0m [34m[fetch][0m set global instance! fetch
[90m21:37:57:631[0m [34m[setup-server:setup][0m adding interceptor dispose subscription
[90m21:37:57:631[0m [34m[setup-server][0m set global instance! setup-server
[90m21:37:57:631[0m [34m[client-request-interceptor:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m21:37:57:631[0m [34m[xhr:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m21:37:57:631[0m [34m[fetch:on][0m adding "request" event listener: async ({ request, requestId, controller }) => {
        const response = await handleRequest(
          request,
          requestId,
          this.handlersController.currentHandlers().filter(isHandlerKind("RequestHandler")),
          this.resolvedOptions,
          this.emitter,
          {
            onPassthroughResponse(request2) {
              const acceptHeader = request2.headers.get("accept");
              if (acceptHeader) {
                const nextAcceptHeader = acceptHeader.replace(
                  /(,\s+)?msw\/passthrough/,
                  ""
                );
                if (nextAcceptHeader) {
                  request2.headers.set("accept", nextAcceptHeader);
                } else {
                  request2.headers.delete("accept");
                }
              }
            }
          }
        );
        if (response) {
          controller.respondWith(response);
        }
        return;
      }
[90m21:37:57:631[0m [34m[client-request-interceptor:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m21:37:57:631[0m [34m[xhr:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m21:37:57:631[0m [34m[fetch:on][0m adding "unhandledException" event listener: ({ error }) => {
      if (error instanceof InternalError) {
        throw error;
      }
    }
[90m21:37:57:631[0m [34m[client-request-interceptor:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m21:37:57:631[0m [34m[xhr:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m21:37:57:631[0m [34m[fetch:on][0m adding "response" event listener: ({ response, isMockedResponse, request, requestId }) => {
        this.emitter.emit(
          isMockedResponse ? "response:mocked" : "response:bypass",
          {
            response,
            request,
            requestId
          }
        );
      }
[90m21:37:57:631[0m [34m[websocket:on][0m adding "connection" event listener: async (connection) => {
    const handlers = options.getHandlers().filter(isHandlerKind("EventHandler"));
    if (handlers.length > 0) {
      options?.onMockedConnection(connection);
      await Promise.all(
        handlers.map((handler) => {
          return handler.run(connection);
        })
      );
      return;
    }
    const request = new Request(connection.client.url, {
      headers: {
        upgrade: "websocket",
        connection: "upgrade"
      }
    });
    await onUnhandledRequest(
      request,
      options.getUnhandledRequestStrategy()
    ).catch((error) => {
      const errorEvent = new Event("error");
      Object.defineProperty(errorEvent, "cause", {
        enumerable: true,
        configurable: false,
        value: error
      });
      connection.client.socket.dispatchEvent(errorEvent);
    });
    options?.onPassthroughConnection(connection);
    connection.server.connect();
  }
[90m21:37:57:631[0m [34m[websocket:apply][0m applying the interceptor...
[90m21:37:57:631[0m [34m[websocket][0m retrieved global instance: undefined
[90m21:37:57:631[0m [34m[websocket:apply][0m no running instance found, setting up a new instance...
[90m21:37:57:632[0m [34m[websocket][0m set global instance! websocket
[90m21:37:57:637[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m21:37:57:637[0m [34m[fetch][0m awaiting for the mocked response...
[90m21:37:57:637[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m21:37:57:660[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m21:37:57:661[0m [34m[fetch][0m emitting the "response" event...
[90m21:37:57:661[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m21:37:57:664[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m21:37:57:664[0m [34m[fetch][0m awaiting for the mocked response...
[90m21:37:57:664[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m21:37:57:666[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m21:37:57:666[0m [34m[fetch][0m emitting the "response" event...
[90m21:37:57:667[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m21:37:57:668[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/register
[90m21:37:57:668[0m [34m[fetch][0m awaiting for the mocked response...
[90m21:37:57:668[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m21:37:57:673[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m21:37:57:673[0m [34m[fetch][0m emitting the "response" event...
[90m21:37:57:673[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m21:37:57:675[0m [34m[fetch][0m [POST] http://localhost:3000/api/auth/login
[90m21:37:57:675[0m [34m[fetch][0m awaiting for the mocked response...
[90m21:37:57:675[0m [34m[fetch][0m emitting the "request" event for 1 listener(s)...
[90m21:37:57:677[0m [34m[fetch][0m received mocked response! {"rawResponse":{}}
[90m21:37:57:677[0m [34m[fetch][0m emitting the "response" event...
[90m21:37:57:677[0m [34m[fetch][0m request has been handled, returning mock promise...
[90m21:37:57:678[0m [34m[setup-server:dispose][0m disposing the interceptor...
[90m21:37:57:678[0m [34m[setup-server][0m retrieved global instance: BatchInterceptor
[90m21:37:57:678[0m [34m[setup-server][0m cleared global instance! setup-server
[90m21:37:57:678[0m [34m[setup-server:dispose][0m global symbol deleted: undefined
[90m21:37:57:678[0m [34m[setup-server:dispose][0m disposing of 3 subscriptions...
[90m21:37:57:678[0m [34m[client-request-interceptor:dispose][0m disposing the interceptor...
[90m21:37:57:678[0m [34m[client-request-interceptor][0m retrieved global instance: _ClientRequestInterceptor
[90m21:37:57:678[0m [34m[client-request-interceptor][0m cleared global instance! client-request-interceptor
[90m21:37:57:678[0m [34m[client-request-interceptor:dispose][0m global symbol deleted: undefined
[90m21:37:57:678[0m [34m[client-request-interceptor:dispose][0m disposing of 1 subscriptions...
[90m21:37:57:678[0m [34m[client-request-interceptor:dispose][0m disposed of all subscriptions! 0
[90m21:37:57:678[0m [34m[client-request-interceptor:dispose][0m destroyed the listener!
[90m21:37:57:678[0m [34m[xhr:dispose][0m disposing the interceptor...
[90m21:37:57:678[0m [34m[xhr][0m retrieved global instance: _XMLHttpRequestInterceptor
[90m21:37:57:678[0m [34m[xhr][0m cleared global instance! xhr
[90m21:37:57:678[0m [34m[xhr:dispose][0m global symbol deleted: undefined
[90m21:37:57:678[0m [34m[xhr:dispose][0m disposing of 1 subscriptions...
[90m21:37:57:678[0m [34m[xhr:setup][0m native "XMLHttpRequest" module restored! XMLHttpRequest
[90m21:37:57:678[0m [34m[xhr:dispose][0m disposed of all subscriptions! 0
[90m21:37:57:678[0m [34m[xhr:dispose][0m destroyed the listener!
[90m21:37:57:678[0m [34m[fetch:dispose][0m disposing the interceptor...
[90m21:37:57:678[0m [34m[fetch][0m retrieved global instance: _FetchInterceptor
[90m21:37:57:678[0m [34m[fetch][0m cleared global instance! fetch
[90m21:37:57:678[0m [34m[fetch:dispose][0m global symbol deleted: undefined
[90m21:37:57:678[0m [34m[fetch:dispose][0m disposing of 1 subscriptions...
[90m21:37:57:678[0m [34m[fetch][0m restored native "globalThis.fetch"! fetch
[90m21:37:57:679[0m [34m[fetch:dispose][0m disposed of all subscriptions! 0
[90m21:37:57:679[0m [34m[fetch:dispose][0m destroyed the listener!
[90m21:37:57:679[0m [34m[setup-server:dispose][0m disposed of all subscriptions! 0
[90m21:37:57:679[0m [34m[setup-server:dispose][0m destroyed the listener!
[90m21:37:57:679[0m [34m[websocket:dispose][0m disposing the interceptor...
[90m21:37:57:679[0m [34m[websocket][0m retrieved global instance: _WebSocketInterceptor
[90m21:37:57:679[0m [34m[websocket][0m cleared global instance! websocket
[90m21:37:57:679[0m [34m[websocket:dispose][0m global symbol deleted: undefined
[90m21:37:57:679[0m [34m[websocket:dispose][0m disposing of 1 subscriptions...
[90m21:37:57:679[0m [34m[websocket:dispose][0m disposed of all subscriptions! 0
[90m21:37:57:679[0m [34m[websocket:dispose][0m destroyed the listener!
 âœ“ |@money-wise/web| __tests__/api/auth.test.tsx  (4 tests) 50ms
 âœ“ |@money-wise/web| __tests__/pages/home.test.tsx  (4 tests) 198ms
 âœ“ |@money-wise/web| __tests__/components/ui/button.test.tsx  (9 tests) 416ms

 Test Files  3 passed (3)
      Tests  17 passed (17)
   Start at  21:37:55
   Duration  2.27s (transform 150ms, setup 348ms, collect 918ms, tests 664ms, environment 2.02s, prepare 1.16s)

