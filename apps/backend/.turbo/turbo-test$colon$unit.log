
> @money-wise/backend@0.4.1 test:unit /home/nemesi/dev/money-wise/apps/backend
> jest --passWithNoTests --testPathPattern='__tests__/unit'

  console.log
    ğŸ³ Starting PostgreSQL test container...

      at DatabaseTestManager.start (src/core/database/tests/database-test.config.ts:53:15)

  console.log
    âœ… Test container started on port 33097

      at DatabaseTestManager.startContainer (src/core/database/tests/database-test.config.ts:92:15)

  console.log
    âœ… Test database initialized

      at DatabaseTestManager.initializeDataSource (src/core/database/tests/database-test.config.ts:144:15)

  console.warn
    âš ï¸ TimescaleDB extension not available: extension "timescaledb" is not available

      149 |         console.log('âœ… TimescaleDB extension enabled');
      150 |       } catch (error) {
    > 151 |         console.warn('âš ï¸ TimescaleDB extension not available:', error.message);
          |                 ^
      152 |       }
      153 |     } catch (error) {
      154 |       console.error('âŒ Failed to initialize test database:', error);

      at DatabaseTestManager.initializeDataSource (src/core/database/tests/database-test.config.ts:151:17)
      at DatabaseTestManager.start (src/core/database/tests/database-test.config.ts:60:5)
      at Object.<anonymous> (__tests__/unit/core/database/migrations/migration.test.ts:17:18)

  console.log
    ğŸ›‘ Test database stopped

      at DatabaseTestManager.stop (src/core/database/tests/database-test.config.ts:235:13)

PASS @money-wise/backend __tests__/unit/core/database/migrations/migration.test.ts (19.392 s)
  Database Migrations
    Schema Creation
      âœ“ should create all tables with correct structure (464 ms)
      âœ“ should create all required columns for users table (469 ms)
      âœ“ should create all required columns for accounts table (413 ms)
      âœ“ should create all required columns for transactions table (465 ms)
      âœ“ should create all required columns for categories table (470 ms)
    Indexes and Constraints
      âœ“ should create all required indexes (451 ms)
      âœ“ should create all foreign key constraints (466 ms)
      âœ“ should create unique constraints (457 ms)
    Migration Rollback
      âœ“ should be able to drop and recreate schema (742 ms)
      âœ“ should handle schema changes gracefully (740 ms)
    Data Type Validation
      âœ“ should validate JSONB columns work correctly (428 ms)
      âœ“ should validate enum constraints (416 ms)
      âœ“ should validate decimal precision for monetary values (486 ms)
    Performance and Scalability
      âœ“ should handle large schema operations efficiently (535 ms)
      âœ“ should validate entity metadata matches database schema (478 ms)

PASS @money-wise/backend __tests__/unit/core/database/entities/entity-relationships.test.ts (10.281 s)
  Entity Relationships
    User -> Account Relationship
      âœ“ should create user with multiple accounts (605 ms)
      âœ“ should cascade delete accounts when user is deleted (479 ms)
      âœ“ should enforce foreign key constraint (481 ms)
    Account -> Transaction Relationship
      âœ“ should create account with multiple transactions (497 ms)
      âœ“ should cascade delete transactions when account is deleted (517 ms)
    Category -> Transaction Relationship
      âœ“ should associate transaction with category (479 ms)
      âœ“ should handle category deletion with SET NULL (507 ms)
      âœ“ should allow transaction without category (469 ms)
    Category Tree Structure
      âœ“ should create parent-child category relationships (550 ms)
      âœ“ should cascade delete child categories when parent is deleted (450 ms)
      âœ“ should validate category tree depth (484 ms)
    Complex Relationship Queries
      âœ“ should find all transactions for a user across accounts (526 ms)
      âœ“ should calculate account balance from transactions (490 ms)
      âœ“ should find categories with transaction counts (472 ms)
    Constraint Validation
      âœ“ should enforce unique email constraint (462 ms)
      âœ“ should enforce unique category slug constraint (472 ms)
      âœ“ should enforce transaction amount precision (544 ms)
      âœ“ should enforce enum constraints (432 ms)
    Index Performance
      âœ“ should use indexes for common queries (519 ms)

PASS @money-wise/backend __tests__/unit/auth/services/password-security.service.spec.ts
  PasswordSecurityService
    hashPassword
      âœ“ should hash password with bcrypt (300 ms)
      âœ“ should hash password with argon2 (174 ms)
    verifyPassword
      âœ“ should verify bcrypt password correctly (804 ms)
      âœ“ should verify argon2 password correctly (495 ms)
      âœ“ should auto-detect hashing algorithm (895 ms)
    validatePassword
      âœ“ should validate strong password (4 ms)
      âœ“ should reject weak password (4 ms)
    isPasswordExpired
      âœ“ should return false for recent password (5 ms)
      âœ“ should return true for old password (3 ms)
    getDaysUntilExpiration
      âœ“ should calculate days until expiration correctly (2 ms)
    shouldWarnPasswordExpiry
      âœ“ should warn when password expires soon (4 ms)
      âœ“ should not warn when password is not expiring soon (4 ms)

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:10 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError setting up 2FA:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:10 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mBadRequestException: User not found[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:10 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError setting up 2FA:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:10 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: QR generation failed[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA setup:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError disabling 2FA:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError checking 2FA status:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError generating new backup codes:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: ECONNREFUSED: Redis connection refused[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA setup:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:11 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mSyntaxError: Unexpected token 'i', "invalid-json{{{" is not valid JSON[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:12 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError generating new backup codes:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:12 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis write failed[39m
PASS @money-wise/backend __tests__/unit/auth/services/two-factor-auth.service.spec.ts
  TwoFactorAuthService
    setupTwoFactor
      âœ“ should generate 2FA setup with secret, QR code, and backup codes (9 ms)
      âœ“ should throw error if user not found (21 ms)
      âœ“ should throw error if QR code generation fails (9 ms)
      âœ“ should store setup data with 10-minute expiration (4 ms)
      âœ“ should generate unique backup codes (2 ms)
    verifyAndEnable2FA
      âœ“ should enable 2FA with valid token (3 ms)
      âœ“ should throw error for invalid token (3 ms)
      âœ“ should throw error if setup data not found (3 ms)
      âœ“ should throw error if setup data expired (1109 ms)
      âœ“ should handle Redis errors gracefully (4 ms)
    verifyTwoFactor
      âœ“ should verify valid TOTP token (3 ms)
      âœ“ should verify valid backup code when TOTP fails (11 ms)
      âœ“ should throw error for already used backup code (3 ms)
      âœ“ should throw error for invalid token and backup code (4 ms)
      âœ“ should throw error if 2FA not enabled (3 ms)
      âœ“ should handle Redis errors gracefully (3 ms)
    disable2FA
      âœ“ should disable 2FA with valid token (3 ms)
      âœ“ should throw error for invalid token when disabling (2 ms)
      âœ“ should handle Redis errors gracefully (3 ms)
    is2FAEnabled
      âœ“ should return true if 2FA is enabled (7 ms)
      âœ“ should return false if 2FA is not enabled (2 ms)
      âœ“ should return false on Redis errors (3 ms)
    generateNewBackupCodes
      âœ“ should generate new backup codes with valid token (2 ms)
      âœ“ should throw error for invalid token when generating new codes (4 ms)
      âœ“ should throw error if 2FA not enabled (4 ms)
      âœ“ should handle Redis errors gracefully (3 ms)
    onModuleDestroy
      âœ“ should close Redis connection on module destroy (3 ms)
    Edge Cases and Advanced Scenarios
      âœ“ should handle backup code exhaustion (all codes used) (4 ms)
      âœ“ should handle concurrent 2FA setup attempts by same user (3 ms)
      âœ“ should handle 2FA verification with Redis connection failure (7 ms)
      âœ“ should handle backup code verification when only 1 code remains (3 ms)
      âœ“ should handle case-insensitive backup code verification (3 ms)
      âœ“ should prevent disabling 2FA with backup code (require TOTP) (4 ms)
      âœ“ should handle malformed 2FA setup data in Redis (3 ms)
      âœ“ should handle setup expiration edge case (expires during verification) (1104 ms)
      âœ“ should generate exactly 10 unique backup codes every time (4 ms)
      âœ“ should handle TOTP token validation at time boundary (clock skew) (4 ms)
      âœ“ should handle new backup code generation when Redis save fails (3 ms)

PASS @money-wise/backend __tests__/unit/auth/auth.controller.spec.ts
  AuthController
    register
      âœ“ should register a new user successfully (7 ms)
      âœ“ should throw ConflictException when user already exists (11 ms)
      âœ“ should handle invalid registration data (3 ms)
    login
      âœ“ should login user successfully (3 ms)
      âœ“ should throw UnauthorizedException with invalid credentials (3 ms)
      âœ“ should throw UnauthorizedException for inactive user (10 ms)
      âœ“ should handle empty credentials (2 ms)
    refreshToken
      âœ“ should refresh token successfully (3 ms)
      âœ“ should throw UnauthorizedException with invalid refresh token (2 ms)
      âœ“ should throw UnauthorizedException with expired refresh token (3 ms)
      âœ“ should handle malformed refresh token (3 ms)
    getProfile
      âœ“ should return current user profile (3 ms)
      âœ“ should include virtual properties in profile (2 ms)
      âœ“ should handle user with null optional fields (2 ms)
    logout
      âœ“ should logout successfully (2 ms)
      âœ“ should handle logout for any authenticated user (4 ms)
    error handling
      âœ“ should propagate service errors correctly (10 ms)
      âœ“ should handle unexpected errors during login (4 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/category.repository.spec.ts
  CategoryRepository
    findBySlug
      âœ“ should find category by slug (6 ms)
      âœ“ should return null when category not found (8 ms)
      âœ“ should handle findBySlug errors (21 ms)
    findByType
      âœ“ should find categories by type (active only) (3 ms)
      âœ“ should include inactive categories when requested (3 ms)
      âœ“ should handle findByType errors (3 ms)
    findByStatus
      âœ“ should find categories by status (4 ms)
      âœ“ should handle findByStatus errors (2 ms)
    findRootCategories
      âœ“ should find all root categories (3 ms)
      âœ“ should filter root categories by type (8 ms)
      âœ“ should handle findRootCategories errors (3 ms)
    findChildCategories
      âœ“ should find child categories (active only) (2 ms)
      âœ“ should include inactive children when requested (2 ms)
      âœ“ should handle findChildCategories errors (2 ms)
    findCategoryTree
      âœ“ should find full category tree (2 ms)
      âœ“ should find tree starting from specific parent (2 ms)
      âœ“ should handle findCategoryTree errors (3 ms)
    findCategoriesWithRules
      âœ“ should find categories with rules (3 ms)
      âœ“ should filter by type (2 ms)
      âœ“ should handle findCategoriesWithRules errors (2 ms)
    findDefaultCategories
      âœ“ should find default categories (2 ms)
      âœ“ should filter default categories by type (2 ms)
      âœ“ should handle findDefaultCategories errors (8 ms)
    findSystemCategories
      âœ“ should find system categories (3 ms)
      âœ“ should filter system categories by type (2 ms)
      âœ“ should handle findSystemCategories errors (2 ms)
    searchCategories
      âœ“ should search categories by name and description (2 ms)
      âœ“ should filter search by type (2 ms)
      âœ“ should handle searchCategories errors (3 ms)
    isSlugAvailable
      âœ“ should return true when slug is available (2 ms)
      âœ“ should return false when slug is taken (3 ms)
      âœ“ should exclude specified category from check (2 ms)
      âœ“ should handle isSlugAvailable errors (2 ms)
    updateStatus
      âœ“ should update category status (2 ms)
      âœ“ should return null when category not found (11 ms)
      âœ“ should handle updateStatus errors (3 ms)
    moveCategory
      âœ“ should move category to new parent (3 ms)
      âœ“ should move category to root level (3 ms)
      âœ“ should handle moveCategory errors (3 ms)
    updateSortOrder
      âœ“ should update category sort order (3 ms)
      âœ“ should handle updateSortOrder errors (2 ms)
    getCategoryUsageStats
      âœ“ should get category usage statistics (3 ms)
      âœ“ should handle null values in stats (3 ms)
      âœ“ should handle getCategoryUsageStats errors (3 ms)
    findMatchingCategories
      âœ“ should find matching categories based on keywords (2 ms)
      âœ“ should match by merchant patterns (2 ms)
      âœ“ should match by amount ranges (2 ms)
      âœ“ should return empty array when no matches (7 ms)
      âœ“ should handle findMatchingCategories errors (3 ms)
    archiveAndReassign
      âœ“ should archive category and reassign transactions (2 ms)
      âœ“ should handle archiveAndReassign errors (2 ms)
    createDefaultCategories
      âœ“ should create default categories (3 ms)
      âœ“ should handle createDefaultCategories errors (2 ms)
    updateRules
      âœ“ should update category rules (2 ms)
      âœ“ should handle updateRules errors (2 ms)
    updateMetadata
      âœ“ should update category metadata (2 ms)
      âœ“ should handle updateMetadata errors (2 ms)
    reorderCategories
      âœ“ should reorder categories under parent (2 ms)
      âœ“ should reorder categories at root level (2 ms)
      âœ“ should handle reorderCategories errors (8 ms)
    Edge Cases
      âœ“ should handle empty string slug (2 ms)
      âœ“ should handle special characters in search (2 ms)
      âœ“ should handle large category trees (3 ms)
      âœ“ should handle category with no transactions in usage stats (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/user.repository.spec.ts
  UserRepository
    findByEmail
      âœ“ should find user by email (case-insensitive) (21 ms)
      âœ“ should convert email to lowercase before querying (5 ms)
      âœ“ should return null when user not found (4 ms)
      âœ“ should handle findByEmail errors (39 ms)
    isEmailTaken
      âœ“ should return true when email is taken (6 ms)
      âœ“ should return false when email is not taken (5 ms)
      âœ“ should exclude specific user when checking email availability (6 ms)
      âœ“ should return true when email exists for different user (35 ms)
      âœ“ should handle isEmailTaken errors (6 ms)
    findByEmailVerificationToken
      âœ“ should return null and log warning (not implemented) (5 ms)
      âœ“ should handle errors in findByEmailVerificationToken (5 ms)
    findByPasswordResetToken
      âœ“ should return null and log warning (not implemented) (4 ms)
      âœ“ should handle errors in findByPasswordResetToken (5 ms)
    markEmailAsVerified
      âœ“ should mark email as verified successfully (4 ms)
      âœ“ should return false when user not found (3 ms)
      âœ“ should return false when affected is undefined (4 ms)
      âœ“ should handle markEmailAsVerified errors (2 ms)
    updatePasswordHash
      âœ“ should update password hash successfully (2 ms)
      âœ“ should return false when user not found (2 ms)
      âœ“ should handle updatePasswordHash errors (4 ms)
    setPasswordResetToken
      âœ“ should return false and log warning (not implemented) (3 ms)
      âœ“ should handle errors in setPasswordResetToken (9 ms)
    clearPasswordResetToken
      âœ“ should return false and log warning (not implemented) (4 ms)
      âœ“ should handle errors in clearPasswordResetToken (4 ms)
    findWithAccounts
      âœ“ should find user with accounts successfully (3 ms)
      âœ“ should return null when user not found (2 ms)
      âœ“ should handle findWithAccounts errors (2 ms)
    findByDateRange
      âœ“ should find users within date range (2 ms)
      âœ“ should return empty array when no users found in range (2 ms)
      âœ“ should handle findByDateRange errors (3 ms)
    getUserStats
      âœ“ should return comprehensive user statistics (2 ms)
      âœ“ should calculate stats with zero users (2 ms)
      âœ“ should calculate stats with all verified users (2 ms)
      âœ“ should use 7-day window for recently created (10 ms)
      âœ“ should handle getUserStats errors (3 ms)
    softDelete
      âœ“ should log soft delete and return true (2 ms)
      âœ“ should handle softDelete errors (4 ms)
    search
      âœ“ should search users by firstName (3 ms)
      âœ“ should search users by lastName (2 ms)
      âœ“ should search users by email (2 ms)
      âœ“ should apply custom limit (2 ms)
      âœ“ should use default limit of 10 (2 ms)
      âœ“ should return empty array when no matches found (1 ms)
      âœ“ should handle partial matches (2 ms)
      âœ“ should handle search errors (3 ms)
      âœ“ should handle special characters in search query (1 ms)
      âœ“ should be case-insensitive (7 ms)

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError generating verification token:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis connection failed[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError verifying email:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Database connection failed[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError resending verification email:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Database error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError checking verification requirement:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Database error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError getting token info:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError cleaning up expired tokens:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError getting verification stats:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError getting token info:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:16 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mSyntaxError: Unexpected token 'i', "invalid-json{{{" is not valid JSON[39m
PASS @money-wise/backend __tests__/unit/auth/services/email-verification.service.spec.ts
  EmailVerificationService
    generateVerificationToken
      âœ“ should generate and store verification token for valid user (5 ms)
      âœ“ should set token expiration to 24 hours from creation (3 ms)
      âœ“ should generate unique tokens for multiple calls (3 ms)
      âœ“ should handle Redis errors gracefully during token generation (23 ms)
      âœ“ should store both token data and user reverse lookup (3 ms)
    verifyEmail
      âœ“ should successfully verify email with valid token (3 ms)
      âœ“ should reject invalid token (3 ms)
      âœ“ should reject expired token (3 ms)
      âœ“ should reject token for non-existent user (3 ms)
      âœ“ should reject token if email does not match user (2 ms)
      âœ“ should handle already verified email gracefully (3 ms)
      âœ“ should sanitize user data in response (exclude password) (3 ms)
      âœ“ should handle database errors during verification (2 ms)
    resendVerificationEmail
      âœ“ should resend verification email for valid user (2 ms)
      âœ“ should reject resend for non-existent user (7 ms)
      âœ“ should reject resend for already verified email (2 ms)
      âœ“ should prevent resending if token was sent recently (within 1 hour) (3 ms)
      âœ“ should allow resending if existing token expires soon (less than 1 hour) (2 ms)
      âœ“ should clean up expired existing token before generating new one (2 ms)
      âœ“ should handle database errors during resend (3 ms)
    isVerificationRequired
      âœ“ should return true for unverified user (2 ms)
      âœ“ should return false for verified user (2 ms)
      âœ“ should return true for non-existent user (fail-safe) (2 ms)
      âœ“ should return true on database error (fail-safe) (3 ms)
    getTokenInfo
      âœ“ should return token information for valid token (3 ms)
      âœ“ should return null for non-existent token (3 ms)
      âœ“ should handle Redis errors gracefully (2 ms)
    cleanupExpiredTokens
      âœ“ should delete expired tokens (10 ms)
      âœ“ should return 0 if no expired tokens found (4 ms)
      âœ“ should handle Redis errors gracefully during cleanup (3 ms)
    getVerificationStats
      âœ“ should return correct statistics (2 ms)
      âœ“ should return zero stats on error (2 ms)
    onModuleDestroy
      âœ“ should close Redis connection on module destroy (2 ms)
    Edge Cases and Race Conditions
      âœ“ should handle multiple concurrent token generation requests (3 ms)
      âœ“ should handle token generation with special characters in email (3 ms)
      âœ“ should handle very long email addresses (2 ms)
      âœ“ should handle verification when Redis is slow (timeout scenario) (112 ms)
      âœ“ should handle cleanup when user has abandoned verification (never completed) (3 ms)
      âœ“ should handle getTokenInfo for malformed token data (2 ms)
      âœ“ should handle resend when previous token was manually deleted (7 ms)
      âœ“ should handle stats calculation with no tokens (2 ms)
      âœ“ should handle verification when user status changes between checks (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/transaction.repository.spec.ts
  TransactionRepository
    findByAccountId
      âœ“ should find transactions by account ID (12 ms)
      âœ“ should apply date range filters (3 ms)
      âœ“ should apply pagination (3 ms)
      âœ“ should include hidden transactions when requested (2 ms)
      âœ“ should handle findByAccountId errors (34 ms)
    findByCategoryId
      âœ“ should find transactions by category ID (5 ms)
      âœ“ should apply date range and pagination (4 ms)
      âœ“ should handle findByCategoryId errors (6 ms)
    findByUserId
      âœ“ should find transactions by user ID (10 ms)
      âœ“ should apply complex filters (4 ms)
      âœ“ should handle findByUserId errors (4 ms)
    findByPlaidTransactionId
      âœ“ should find transaction by Plaid ID (3 ms)
      âœ“ should return null when Plaid transaction not found (4 ms)
      âœ“ should handle findByPlaidTransactionId errors (3 ms)
    findByType
      âœ“ should find transactions by type (3 ms)
      âœ“ should apply optional filters (3 ms)
      âœ“ should handle findByType errors (2 ms)
    findByStatus
      âœ“ should find transactions by status (3 ms)
      âœ“ should apply optional filters (3 ms)
      âœ“ should handle findByStatus errors (3 ms)
    findBySource
      âœ“ should find transactions by source (8 ms)
      âœ“ should apply optional filters (2 ms)
      âœ“ should handle findBySource errors (2 ms)
    findUncategorized
      âœ“ should find uncategorized transactions (2 ms)
      âœ“ should apply optional filters (3 ms)
      âœ“ should handle findUncategorized errors (3 ms)
    findDuplicates
      âœ“ should find duplicate transactions (3 ms)
      âœ“ should apply duplicate detection options (2 ms)
      âœ“ should handle findDuplicates errors (2 ms)
    findRecent
      âœ“ should find recent transactions (2 ms)
      âœ“ should use custom days and limit (2 ms)
      âœ“ should handle findRecent errors (2 ms)
    searchTransactions
      âœ“ should search transactions by term (9 ms)
      âœ“ should apply search filters (3 ms)
      âœ“ should handle searchTransactions errors (2 ms)
    getTransactionStats
      âœ“ should get transaction statistics (2 ms)
      âœ“ should handle getTransactionStats errors (1 ms)
    updateCategory
      âœ“ should update transaction category (2 ms)
      âœ“ should handle null category (uncategorize) (2 ms)
      âœ“ should return null when transaction not found (2 ms)
      âœ“ should handle updateCategory errors (1 ms)
    updateDescription
      âœ“ should update transaction description (2 ms)
      âœ“ should handle updateDescription errors (2 ms)
    toggleHidden
      âœ“ should toggle hidden status from false to true (2 ms)
      âœ“ should toggle hidden status from true to false (7 ms)
      âœ“ should return null when transaction not found (2 ms)
      âœ“ should handle toggleHidden errors (3 ms)
    addNotes
      âœ“ should add notes to transaction (3 ms)
      âœ“ should handle addNotes errors (3 ms)
    addTags
      âœ“ should add tags to transaction (2 ms)
      âœ“ should handle addTags errors (3 ms)
    getMonthlySpendingByCategory
      âœ“ should throw not implemented error (3 ms)
    createSplit
      âœ“ should throw not implemented error (3 ms)
    bulkCategorize
      âœ“ should throw not implemented error (3 ms)
    findNeedingCategorization
      âœ“ should throw not implemented error (2 ms)
    getCashFlow
      âœ“ should throw not implemented error (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/account.repository.spec.ts
  AccountRepository
    findByUserId
      âœ“ should find accounts by user ID (4 ms)
      âœ“ should handle findByUserId errors (30 ms)
    findActiveAccountsByUserId
      âœ“ should find active accounts by user ID (2 ms)
      âœ“ should handle findActiveAccountsByUserId errors (3 ms)
    updateBalance
      âœ“ should update account currentBalance successfully (3 ms)
      âœ“ should return false when no account was updated (2 ms)
      âœ“ should handle updateBalance errors (3 ms)
    incrementBalance
      âœ“ should increment account currentBalance successfully (2 ms)
      âœ“ should return false when no account was updated (2 ms)
      âœ“ should handle incrementBalance errors (2 ms)
      âœ“ should increment account balance (3 ms)
      âœ“ should return false if account not found (2 ms)
      âœ“ should handle incrementBalance errors (2 ms)
    decrementBalance
      âœ“ should decrement account currentBalance successfully (2 ms)
      âœ“ should handle decrementBalance errors (7 ms)
      âœ“ should decrement account balance (2 ms)
      âœ“ should handle decrementBalance errors (4 ms)
    getTotalBalanceForUser
      âœ“ should get total currentBalance for user (3 ms)
      âœ“ should return 0 when no total found (2 ms)
      âœ“ should handle getTotalBalanceForUser errors (2 ms)
    findByPlaidAccountId
      âœ“ should find account by Plaid account ID (2 ms)
      âœ“ should return null when Plaid account not found (2 ms)
      âœ“ should handle findByPlaidAccountId errors (2 ms)
    deactivateAccount
      âœ“ should deactivate account successfully (3 ms)
      âœ“ should return false when no account was deactivated (2 ms)
      âœ“ should handle deactivateAccount errors (2 ms)
    reactivateAccount
      âœ“ should reactivate account successfully (1 ms)
      âœ“ should handle reactivateAccount errors (2 ms)
    findAccountsForSync
      âœ“ should find accounts for sync with user filter (2 ms)
      âœ“ should find all accounts for sync without user filter (8 ms)
      âœ“ should handle findAccountsForSync errors (2 ms)
    getAccountBalancesSummary
      âœ“ should get account currentBalances summary by type (3 ms)
      âœ“ should handle getAccountBalancesSummary errors (2 ms)
    findLowBalanceAccounts
      âœ“ should find low currentBalance accounts with user filter (3 ms)
      âœ“ should handle findLowBalanceAccounts errors (2 ms)
    findByType
      âœ“ should find accounts by type with userId (2 ms)
      âœ“ should find accounts by type without userId (2 ms)
      âœ“ should handle findByType errors (2 ms)
    findByPlaidItemId
      âœ“ should find accounts by Plaid item ID (3 ms)
      âœ“ should return empty array if no accounts found (3 ms)
      âœ“ should handle findByPlaidItemId errors (11 ms)
    updateLastSyncedAt
      âœ“ should update sync timestamp successfully (3 ms)
      âœ“ should return false if account not found (2 ms)
      âœ“ should handle update errors (3 ms)
    findWithTransactions
      âœ“ should find account with transactions and apply limit (3 ms)
      âœ“ should use default limit of 50 (2 ms)
      âœ“ should return null if account not found (2 ms)
      âœ“ should handle errors (2 ms)
    findByCurrency
      âœ“ should find accounts by currency with userId (7 ms)
      âœ“ should find accounts by currency without userId (2 ms)
      âœ“ should handle errors (2 ms)
    groupByInstitution
      âœ“ should group accounts by institution with totals (3 ms)
      âœ“ should return empty array if no accounts found (2 ms)
      âœ“ should handle errors (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/base.repository.spec.ts
  BaseRepository
    constructor
      âœ“ should initialize repository with correct entity (5 ms)
    create
      âœ“ should create and save a new entity successfully (3 ms)
      âœ“ should handle creation errors and throw descriptive error (29 ms)
    save
      âœ“ should save an existing entity successfully (4 ms)
      âœ“ should handle save errors (14 ms)
    findById
      âœ“ should find entity by ID successfully (5 ms)
      âœ“ should return null when entity not found (8 ms)
      âœ“ should handle findById errors (7 ms)
    findOne
      âœ“ should find one entity with FindOptionsWhere (10 ms)
      âœ“ should find one entity with FindOneOptions (3 ms)
      âœ“ should return null when no entity found (4 ms)
      âœ“ should handle findOne errors (5 ms)
    find
      âœ“ should find multiple entities with options (4 ms)
      âœ“ should find all entities when no options provided (4 ms)
      âœ“ should handle find errors (4 ms)
    findWithPagination
      âœ“ should return paginated results (3 ms)
      âœ“ should handle pagination with criteria (12 ms)
      âœ“ should handle pagination errors (3 ms)
    update
      âœ“ should update entity successfully (4 ms)
      âœ“ should return null when entity to update not found (4 ms)
      âœ“ should handle update errors (3 ms)
    delete
      âœ“ should delete entity successfully (3 ms)
      âœ“ should return false when no entity was deleted (3 ms)
      âœ“ should handle delete errors (2 ms)
    deleteBy
      âœ“ should delete entities by criteria (3 ms)
      âœ“ should return 0 when no entities match deletion criteria (3 ms)
      âœ“ should handle deleteBy errors (2 ms)
    count
      âœ“ should count entities with criteria (3 ms)
      âœ“ should count all entities when no criteria provided (3 ms)
      âœ“ should handle count errors (14 ms)
    exists
      âœ“ should return true when entity exists (5 ms)
      âœ“ should return false when entity does not exist (4 ms)
      âœ“ should handle exists errors (3 ms)
    bulkInsert
      âœ“ should perform bulk insert successfully (3 ms)
      âœ“ should handle bulk insert errors (2 ms)
    bulkUpdate
      âœ“ should perform bulk update successfully (3 ms)
      âœ“ should return 0 when no entities match update criteria (4 ms)
      âœ“ should handle bulk update errors (4 ms)
    query
      âœ“ should execute raw query successfully (3 ms)
      âœ“ should execute parameterized query (3 ms)
      âœ“ should handle query errors (5 ms)
    softDelete
      âœ“ should soft delete entity successfully (4 ms)
      âœ“ should return false when no entity was soft deleted (10 ms)
      âœ“ should handle soft delete errors (6 ms)
      âœ“ should handle null affected count (2 ms)
    restore
      âœ“ should restore soft deleted entity successfully (2 ms)
      âœ“ should return false when no entity was restored (2 ms)
      âœ“ should handle restore errors (2 ms)
      âœ“ should handle undefined affected count (5 ms)
    deleteMany
      âœ“ should delete multiple entities by criteria (3 ms)
      âœ“ should return 0 affected when no entities deleted (3 ms)
      âœ“ should handle null affected count (3 ms)
      âœ“ should handle deleteMany errors (4 ms)
    findAndCount
      âœ“ should find entities with total count (3 ms)
      âœ“ should find and count all entities without options (2 ms)
      âœ“ should handle empty result set (2 ms)
      âœ“ should handle findAndCount errors (2 ms)
    createBulk
      âœ“ should create multiple entities successfully (1 ms)
      âœ“ should handle empty array (2 ms)
      âœ“ should handle createBulk errors (2 ms)
    updateMany
      âœ“ should update multiple entities successfully (3 ms)
      âœ“ should handle zero updates (2 ms)
      âœ“ should handle null affected count (2 ms)
      âœ“ should handle updateMany errors (2 ms)
    existsBy
      âœ“ should return true when entity exists by criteria (2 ms)
      âœ“ should return false when entity does not exist (2 ms)
      âœ“ should return true when multiple entities match criteria (8 ms)
      âœ“ should handle existsBy errors (3 ms)
    protected methods
      createQueryBuilder
        âœ“ should create query builder with alias (2 ms)
        âœ“ should create query builder without alias (2 ms)
      manager
        âœ“ should access entity manager from repository (2 ms)
    edge cases
      findById with options
        âœ“ should apply FindOneOptions when finding by ID (2 ms)
      delete with undefined affected
        âœ“ should handle undefined affected count in delete (2 ms)
      update partial data
        âœ“ should handle partial entity updates (2 ms)
      findWithPagination edge cases
        âœ“ should handle first page pagination (2 ms)
        âœ“ should handle large page numbers (2 ms)
        âœ“ should handle very large limit values (2 ms)
      count with complex options
        âœ“ should handle count with where and order options (2 ms)

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError validating reset token:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError resetting password:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Database error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError getting password reset stats:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError cleaning up expired tokens:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError revoking user tokens:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:20 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
PASS @money-wise/backend __tests__/unit/auth/services/password-reset.service.spec.ts
  PasswordResetService
    Token Generation (requestPasswordReset)
      âœ“ should generate and store reset token for valid user (9 ms)
      âœ“ should prevent multiple token generation within 5 minutes (9 ms)
      âœ“ should set token expiration to 30 minutes from creation (2 ms)
      âœ“ should store token data with metadata in Redis (3 ms)
      âœ“ should clean up expired tokens before creating new one (3 ms)
      âœ“ should handle database errors gracefully during token creation (4 ms)
      âœ“ should log token generation in audit trail (3 ms)
    Rate Limiting
      âœ“ should reject request when rate limit exceeded (3 ms)
      âœ“ should reject request when account is locked out (3 ms)
      âœ“ should log rate limit events in audit trail (2 ms)
    User Enumeration Prevention
      âœ“ should return same success message for non-existent users (7 ms)
      âœ“ should return same success message for inactive users (3 ms)
      âœ“ should record failed attempts for non-existent users (3 ms)
    Token Validation (validateResetToken)
      âœ“ should accept valid unexpired tokens (3 ms)
      âœ“ should reject expired tokens (2 ms)
      âœ“ should reject already-used tokens (3 ms)
      âœ“ should reject invalid token format (3 ms)
      âœ“ should reject tokens for non-existent users (2 ms)
      âœ“ should reject tokens for inactive users (2 ms)
      âœ“ should handle validation errors gracefully (3 ms)
    Password Reset (resetPassword)
      âœ“ should reset password successfully with valid token (3 ms)
      âœ“ should reject mismatched passwords (7 ms)
      âœ“ should reject weak passwords (3 ms)
      âœ“ should mark token as used after successful reset (3 ms)
      âœ“ should clear rate limits after successful reset (2 ms)
      âœ“ should log successful password reset in audit trail (3 ms)
      âœ“ should return email verification requirement status (3 ms)
      âœ“ should handle password change errors gracefully (3 ms)
    Token Management
      âœ“ should handle token cleanup errors gracefully (3 ms)
      âœ“ should not cleanup recent tokens (< 5 minutes old) (4 ms)
    Statistics and Maintenance
      âœ“ should return password reset statistics (2 ms)
      âœ“ should handle errors in statistics gracefully (10 ms)
      âœ“ should cleanup all expired tokens (4 ms)
      âœ“ should handle cleanup errors gracefully (3 ms)
      âœ“ should revoke all tokens for a specific user (3 ms)
      âœ“ should handle revocation when no tokens exist (2 ms)
      âœ“ should handle revocation errors gracefully (3 ms)
    Resource Cleanup
      âœ“ should cleanup Redis connection on module destroy (3 ms)

PASS @money-wise/backend __tests__/unit/common/interceptors/sentry.interceptor.spec.ts
  SentryInterceptor
    intercept
      âœ“ should create interceptor instance (1 ms)

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:22 PM [31m  ERROR[39m [38;5;3m[AuthSecurityService] [39m[31mLogin error:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:22 PM [31m  ERROR[39m [38;5;3m[AuthSecurityService] [39m[31mTypeError: Cannot read properties of undefined (reading 'isLocked')[39m
PASS @money-wise/backend __tests__/unit/auth/auth-security.service.spec.ts
  AuthSecurityService
    âœ“ should be defined (5 ms)
    register
      âœ“ should successfully register a new user (4 ms)
      âœ“ should throw ConflictException if user already exists (22 ms)
      âœ“ should throw BadRequestException for weak password (3 ms)
    login
      âœ“ should successfully login with valid credentials (5 ms)
      âœ“ should throw UnauthorizedException if account is locked (5 ms)
      âœ“ should throw UnauthorizedException for invalid credentials (3 ms)
      âœ“ should record failed attempt on invalid password (11 ms)
    changePassword
      âœ“ should successfully change password (3 ms)
      âœ“ should throw UnauthorizedException for invalid current password (3 ms)
      âœ“ should throw BadRequestException for weak new password (3 ms)
      âœ“ should throw BadRequestException if new password is same as current (7 ms)
    requestPasswordReset
      âœ“ should request password reset (4 ms)
    verifyEmail
      âœ“ should verify email successfully (3 ms)
    checkPasswordStrength
      âœ“ should return password strength analysis (3 ms)
    refreshToken
      âœ“ should successfully refresh token (7 ms)
      âœ“ should throw UnauthorizedException for invalid token (3 ms)

PASS @money-wise/backend __tests__/unit/auth/auth.service.spec.ts
  AuthService
    register
      âœ“ should register a new user successfully (6 ms)
      âœ“ should throw ConflictException if user already exists (17 ms)
    login
      âœ“ should login user successfully (4 ms)
      âœ“ should throw UnauthorizedException if user not found (5 ms)
      âœ“ should throw UnauthorizedException if password is invalid (4 ms)
      âœ“ should throw UnauthorizedException if user is not active (3 ms)
    refreshToken
      âœ“ should refresh token successfully with valid refresh token (15 ms)
      âœ“ should throw UnauthorizedException with invalid refresh token (5 ms)
      âœ“ should throw UnauthorizedException if user not found (4 ms)
      âœ“ should throw UnauthorizedException if user is not active (3 ms)
      âœ“ should throw UnauthorizedException with expired refresh token (3 ms)
    validateUser
      âœ“ should return user if valid (3 ms)
      âœ“ should throw UnauthorizedException if user not found (2 ms)
      âœ“ should throw UnauthorizedException if user is not active (3 ms)
    generateAuthResponse
      âœ“ should generate proper auth response with tokens (3 ms)
    error scenarios
      âœ“ should handle password hashing errors during registration (2 ms)
      âœ“ should handle database errors during user creation (3 ms)
      âœ“ should handle password verification errors during login (11 ms)

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mFailed to log audit event:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mError: ID generation failed[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] suspicious_activity: anonymous from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523698_poh1ea5s9",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.698Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523698_poh1ea5s9",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.698Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: anonymous from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523701_i7mop5zvj",
  "eventType": "account_locked",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.701Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523701_i7mop5zvj",
  "eventType": "account_locked",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.701Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-123 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523729_sytfxs7ql",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "failedAttempts": 5,
    "lockDuration": 3600
  },
  "timestamp": "2025-10-03T11:05:23.729Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523729_sytfxs7ql",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "failedAttempts": 5,
    "lockDuration": 3600
  },
  "timestamp": "2025-10-03T11:05:23.729Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] suspicious_activity: user-123 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523732_v1t32ca4w",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Multiple failed 2FA attempts from different IPs"
  },
  "timestamp": "2025-10-03T11:05:23.732Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523732_v1t32ca4w",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Multiple failed 2FA attempts from different IPs"
  },
  "timestamp": "2025-10-03T11:05:23.732Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] suspicious_activity: anonymous from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523735_uhpfi88kn",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Brute force attack detected"
  },
  "timestamp": "2025-10-03T11:05:23.735Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523735_uhpfi88kn",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Brute force attack detected"
  },
  "timestamp": "2025-10-03T11:05:23.735Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523744_ud1xtlcbn",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.744Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523744_ud1xtlcbn",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.744Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523747_ogx1lx0fx",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.747Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523747_ogx1lx0fx",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.747Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523758_vplz5ra2l",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.758Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523758_vplz5ra2l",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.758Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523763_igsjjfb1s",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.763Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523763_igsjjfb1s",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.763Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523768_vg1r73pkh",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.768Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523768_vg1r73pkh",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.768Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523771_mwdlewsdt",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.771Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523771_mwdlewsdt",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.771Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523774_zyr0h0q12",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.774Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523774_zyr0h0q12",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.774Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523777_i3o7ptvwu",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.777Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523777_i3o7ptvwu",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.777Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523781_y9vs583nh",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.781Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523781_y9vs583nh",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.781Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523785_0ut6a0szl",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.785Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523785_0ut6a0szl",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.785Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523788_ux9n13uti",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.788Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523788_ux9n13uti",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.788Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523790_fbru57q61",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.790Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523790_fbru57q61",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.790Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523794_3ltrb763z",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.794Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523794_3ltrb763z",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.794Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523797_g48k3z3og",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.797Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523797_g48k3z3og",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.797Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mError querying audit logs:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mTypeError: this.auditLogs is not iterable[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523800_8p8mjsgao",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.800Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523800_8p8mjsgao",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.800Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523809_k2l5l3yuj",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.809Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523809_k2l5l3yuj",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.809Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523813_1ucd208b9",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.813Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523813_1ucd208b9",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.813Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523817_a38kothnv",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.817Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523817_a38kothnv",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.817Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523821_e8lsc31y9",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.821Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523821_e8lsc31y9",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.821Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523827_hj01bk859",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.827Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523827_hj01bk859",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.827Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523831_9enx9r99d",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.831Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523831_9enx9r99d",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.831Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523835_phi8r3rjc",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.835Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523835_phi8r3rjc",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.835Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523838_mcbd497y3",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.838Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523838_mcbd497y3",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.838Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523840_5eof3juqj",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.840Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523840_5eof3juqj",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.840Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mError getting audit stats:[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mTypeError: Cannot read properties of null (reading 'filter')[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523844_2v5pmr6ao",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.844Z"
}

[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 1985449  - [39m10/03/2025, 1:05:23 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759489523844_2v5pmr6ao",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:05:23.844Z"
}

PASS @money-wise/backend __tests__/unit/auth/services/audit-log.service.spec.ts
  AuditLogService
    logEvent
      âœ“ should log a basic audit event (5 ms)
      âœ“ should extract client IP from x-forwarded-for header (2 ms)
      âœ“ should extract client IP from x-real-ip header when x-forwarded-for not available (3 ms)
      âœ“ should fall back to connection.remoteAddress for IP (10 ms)
      âœ“ should use "unknown" when no IP can be determined (2 ms)
      âœ“ should extract session ID from x-session-id header (2 ms)
      âœ“ should extract user-agent from request (2 ms)
      âœ“ should use "unknown" for missing user-agent (2 ms)
      âœ“ should store custom details in audit event (4 ms)
      âœ“ should not throw on logging errors (2 ms)
      âœ“ should cap audit logs at maxLogEntries (10000) (8 ms)
    determineSeverity
      âœ“ should assign CRITICAL severity to suspicious activity (3 ms)
      âœ“ should assign CRITICAL severity to account locked (3 ms)
      âœ“ should assign HIGH severity to login failed (8 ms)
      âœ“ should assign HIGH severity to rate limit exceeded (2 ms)
      âœ“ should assign MEDIUM severity to password change success (2 ms)
      âœ“ should assign LOW severity to login success (3 ms)
    logLoginSuccess
      âœ“ should log successful login with user details (3 ms)
    logLoginFailed
      âœ“ should log failed login attempt with reason (5 ms)
    logAccountLocked
      âœ“ should log account lockout with details (4 ms)
    logSuspiciousActivity
      âœ“ should log suspicious activity with description (3 ms)
      âœ“ should log anonymous suspicious activity (3 ms)
    logPasswordChange
      âœ“ should log successful password change (3 ms)
      âœ“ should log failed password change (3 ms)
    queryLogs
      âœ“ should query all logs without filters (3 ms)
      âœ“ should filter logs by userId (3 ms)
      âœ“ should filter logs by single eventType (12 ms)
      âœ“ should filter logs by multiple eventTypes (4 ms)
      âœ“ should filter logs by single severity (4 ms)
      âœ“ should filter logs by multiple severities (3 ms)
      âœ“ should filter logs by ipAddress (3 ms)
      âœ“ should filter logs by date range (startDate) (3 ms)
      âœ“ should filter logs by date range (endDate) (4 ms)
      âœ“ should filter logs by date range (startDate and endDate) (4 ms)
      âœ“ should sort logs by timestamp (newest first) (3 ms)
      âœ“ should apply pagination with offset and limit (3 ms)
      âœ“ should apply default pagination (limit 100) (3 ms)
      âœ“ should handle errors gracefully (3 ms)
      âœ“ should combine multiple filters (8 ms)
    getAuditStats
      âœ“ should return stats for hour timeframe (4 ms)
      âœ“ should return stats for day timeframe (default) (4 ms)
      âœ“ should count unique users correctly (3 ms)
      âœ“ should count unique IPs correctly (5 ms)
      âœ“ should count events by severity (6 ms)
      âœ“ should handle week timeframe (3 ms)
      âœ“ should handle month timeframe (4 ms)
      âœ“ should exclude events outside timeframe (3 ms)
      âœ“ should handle errors gracefully (3 ms)
      âœ“ should handle empty audit logs (3 ms)
    Edge Cases
      âœ“ should handle multiple events from same user at different IPs (2 ms)
      âœ“ should handle events with empty details (7 ms)
      âœ“ should handle events without userId or email (3 ms)
      âœ“ should generate unique IDs for all events (3 ms)
      âœ“ should handle very large details objects (2 ms)
      âœ“ should handle pagination beyond available logs (3 ms)
      âœ“ should handle concurrent logging of multiple events (2 ms)

PASS @money-wise/backend __tests__/unit/auth/controllers/password.controller.spec.ts
  PasswordController
    checkPasswordStrength
      âœ“ should return password strength result (6 ms)
    changePassword
      âœ“ should change password successfully (3 ms)
      âœ“ should throw error for mismatched passwords (10 ms)
      âœ“ should throw error when rate limited (4 ms)
      âœ“ should throw error for incorrect current password (4 ms)
    requestPasswordReset
      âœ“ should request password reset successfully (3 ms)
    validateResetToken
      âœ“ should validate reset token successfully (12 ms)
      âœ“ should return invalid for bad token (3 ms)
    resetPassword
      âœ“ should reset password successfully (2 ms)
      âœ“ should throw error for failed reset (3 ms)
    getPasswordPolicy
      âœ“ should return password policy (3 ms)
    getPasswordStatus
      âœ“ should return password status (4 ms)
      âœ“ should return expired status (4 ms)

PASS @money-wise/backend __tests__/unit/auth/jwt.strategy.spec.ts
  JwtStrategy
    constructor
      âœ“ should be defined (10 ms)
      âœ“ should configure strategy with correct options (2 ms)
    validate
      âœ“ should return user for valid payload (2 ms)
      âœ“ should throw UnauthorizedException when user validation fails (8 ms)
      âœ“ should throw UnauthorizedException with custom message for invalid token (4 ms)
      âœ“ should handle payload with different user roles (3 ms)
      âœ“ should handle payload with missing fields (3 ms)
      âœ“ should handle payload with invalid user ID format (2 ms)
      âœ“ should handle null or undefined payload gracefully (8 ms)
      âœ“ should handle empty payload object (2 ms)
      âœ“ should propagate specific error messages from AuthService (4 ms)
      âœ“ should handle concurrent validation requests (2 ms)
    error scenarios
      âœ“ should handle AuthService throwing non-UnauthorizedException errors (2 ms)
      âœ“ should handle AuthService returning null unexpectedly (3 ms)
      âœ“ should handle malformed JWT payload structure (2 ms)

PASS @money-wise/backend __tests__/unit/auth/jwt-auth.guard.spec.ts
  JwtAuthGuard
    canActivate
      âœ“ should return true for public routes (4 ms)
      âœ“ should call super.canActivate for protected routes (2 ms)
      âœ“ should handle undefined public key (2 ms)
      âœ“ should properly check method and class decorators (2 ms)
    handleRequest
      âœ“ should return user when no error and user exists (2 ms)
      âœ“ should throw UnauthorizedException when error exists (8 ms)
      âœ“ should throw UnauthorizedException when user is null (3 ms)
      âœ“ should throw UnauthorizedException when user is undefined (10 ms)
      âœ“ should throw custom UnauthorizedException with proper message (3 ms)
      âœ“ should prioritize original error over missing user (3 ms)
      âœ“ should handle falsy user values (4 ms)
      âœ“ should handle truthy user values (2 ms)
    integration scenarios
      âœ“ should handle public route with missing user gracefully (2 ms)
      âœ“ should handle protected route with valid token (2 ms)

PASS @money-wise/backend __tests__/unit/core/health/health.controller.spec.ts
  HealthController
    âœ“ should be defined (5 ms)
    getHealth
      âœ“ should return basic health status (3 ms)
      âœ“ should return consistent timestamp format (3 ms)
      âœ“ should return positive uptime (2 ms)
      âœ“ should return memory usage (9 ms)
    getDetailedHealth
      âœ“ should return detailed health with services status (5 ms)
      âœ“ should include database response time (4 ms)
    getReadiness
      âœ“ should return readiness status (4 ms)
    getLiveness
      âœ“ should return liveness status (3 ms)

PASS @money-wise/backend __tests__/unit/common/decorators/sentry-transaction.decorator.spec.ts
  SentryTransactionDecorator
    withSentryTransaction
      âœ“ should wrap function with Sentry transaction (2 ms)
      âœ“ should handle errors in wrapped function (4 ms)
    SentryTransactionManager
      âœ“ should manage transaction lifecycle (1 ms)

PASS @money-wise/backend __tests__/unit/auth/services/password-strength.service.spec.ts
  PasswordStrengthService
    calculateStrength
      âœ“ should return very weak for simple passwords (5 ms)
      âœ“ should return strong for complex passwords (3 ms)
      âœ“ should detect common passwords (4 ms)
      âœ“ should detect personal information in password (3 ms)
      âœ“ should detect repeating characters (5 ms)
      âœ“ should detect sequential characters (3 ms)
    validatePolicy
      âœ“ should validate minimum length requirement (2 ms)
      âœ“ should validate character requirements (3 ms)
      âœ“ should pass for valid passwords (3 ms)

PASS @money-wise/backend __tests__/unit/docs/openapi.spec.ts
  OpenAPI Specification
    âœ“ should generate valid OpenAPI spec (1 ms)

Test Suites: 23 passed, 23 total
Tests:       637 passed, 637 total
Snapshots:   0 total
Time:        53.076 s
Ran all test suites matching /__tests__\/unit/i.
