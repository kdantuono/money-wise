
> @money-wise/backend@0.4.1 test:unit /home/nemesi/dev/money-wise/apps/backend
> jest --passWithNoTests --testPathPattern='__tests__/unit'

  console.log
    üê≥ Starting PostgreSQL test container...

      at DatabaseTestManager.start (src/core/database/tests/database-test.config.ts:53:15)

  console.log
    ‚úÖ Test container started on port 33118

      at DatabaseTestManager.startContainer (src/core/database/tests/database-test.config.ts:92:15)

  console.log
    ‚úÖ Test database initialized

      at DatabaseTestManager.initializeDataSource (src/core/database/tests/database-test.config.ts:144:15)

  console.warn
    ‚ö†Ô∏è TimescaleDB extension not available: extension "timescaledb" is not available

      149 |         console.log('‚úÖ TimescaleDB extension enabled');
      150 |       } catch (error) {
    > 151 |         console.warn('‚ö†Ô∏è TimescaleDB extension not available:', error.message);
          |                 ^
      152 |       }
      153 |     } catch (error) {
      154 |       console.error('‚ùå Failed to initialize test database:', error);

      at DatabaseTestManager.initializeDataSource (src/core/database/tests/database-test.config.ts:151:17)
      at DatabaseTestManager.start (src/core/database/tests/database-test.config.ts:60:5)
      at Object.<anonymous> (__tests__/unit/core/database/migrations/migration.test.ts:17:18)

  console.log
    üõë Test database stopped

      at DatabaseTestManager.stop (src/core/database/tests/database-test.config.ts:235:13)

PASS @money-wise/backend __tests__/unit/core/database/migrations/migration.test.ts (19.634 s)
  Database Migrations
    Schema Creation
      ‚úì should create all tables with correct structure (438 ms)
      ‚úì should create all required columns for users table (515 ms)
      ‚úì should create all required columns for accounts table (502 ms)
      ‚úì should create all required columns for transactions table (471 ms)
      ‚úì should create all required columns for categories table (424 ms)
    Indexes and Constraints
      ‚úì should create all required indexes (455 ms)
      ‚úì should create all foreign key constraints (492 ms)
      ‚úì should create unique constraints (473 ms)
    Migration Rollback
      ‚úì should be able to drop and recreate schema (754 ms)
      ‚úì should handle schema changes gracefully (733 ms)
    Data Type Validation
      ‚úì should validate JSONB columns work correctly (514 ms)
      ‚úì should validate enum constraints (431 ms)
      ‚úì should validate decimal precision for monetary values (427 ms)
    Performance and Scalability
      ‚úì should handle large schema operations efficiently (545 ms)
      ‚úì should validate entity metadata matches database schema (505 ms)

PASS @money-wise/backend __tests__/unit/auth/auth.controller.spec.ts
  AuthController
    register
      ‚úì should register a new user successfully (17 ms)
      ‚úì should throw ConflictException when user already exists (15 ms)
      ‚úì should handle invalid registration data (4 ms)
    login
      ‚úì should login user successfully (3 ms)
      ‚úì should throw UnauthorizedException with invalid credentials (4 ms)
      ‚úì should throw UnauthorizedException for inactive user (9 ms)
      ‚úì should handle empty credentials (5 ms)
    refreshToken
      ‚úì should refresh token successfully (3 ms)
      ‚úì should throw UnauthorizedException with invalid refresh token (4 ms)
      ‚úì should throw UnauthorizedException with expired refresh token (3 ms)
      ‚úì should handle malformed refresh token (4 ms)
    getProfile
      ‚úì should return current user profile (5 ms)
      ‚úì should include virtual properties in profile (2 ms)
      ‚úì should handle user with null optional fields (3 ms)
    logout
      ‚úì should logout successfully (3 ms)
      ‚úì should handle logout for any authenticated user (3 ms)
    changePassword
      ‚úì should change password successfully (9 ms)
      ‚úì should throw error for invalid current password (4 ms)
      ‚úì should throw error for weak new password (4 ms)
    requestPasswordReset
      ‚úì should request password reset successfully (2 ms)
      ‚úì should handle non-existent email gracefully (2 ms)
      ‚úì should handle service errors (3 ms)
    resetPassword
      ‚úì should reset password successfully (2 ms)
      ‚úì should throw error for invalid token (3 ms)
      ‚úì should throw error for weak password (2 ms)
      ‚úì should throw error for expired token (3 ms)
    validatePasswordResetToken
      ‚úì should validate token successfully (3 ms)
      ‚úì should return invalid for expired token (2 ms)
      ‚úì should return invalid for malformed token (2 ms)
    verifyEmail
      ‚úì should verify email successfully (11 ms)
      ‚úì should throw error for invalid token (4 ms)
      ‚úì should throw error for expired token (4 ms)
      ‚úì should throw error for already verified email (3 ms)
    resendEmailVerification
      ‚úì should resend verification email successfully (3 ms)
      ‚úì should throw error for already verified email (4 ms)
      ‚úì should handle rate limiting (3 ms)
      ‚úì should handle email service errors (4 ms)
    checkPasswordStrength
      ‚úì should return strong password result (3 ms)
      ‚úì should return weak password result (3 ms)
      ‚úì should detect password with user information (3 ms)
      ‚úì should handle empty password (2 ms)
    error handling
      ‚úì should propagate service errors correctly (7 ms)
      ‚úì should handle unexpected errors during login (3 ms)
      ‚úì should handle service timeout errors (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/entities/entity-relationships.test.ts (11.189 s)
  Entity Relationships
    User -> Account Relationship
      ‚úì should create user with multiple accounts (515 ms)
      ‚úì should cascade delete accounts when user is deleted (499 ms)
      ‚úì should enforce foreign key constraint (531 ms)
    Account -> Transaction Relationship
      ‚úì should create account with multiple transactions (496 ms)
      ‚úì should cascade delete transactions when account is deleted (559 ms)
    Category -> Transaction Relationship
      ‚úì should associate transaction with category (490 ms)
      ‚úì should handle category deletion with SET NULL (599 ms)
      ‚úì should allow transaction without category (459 ms)
    Category Tree Structure
      ‚úì should create parent-child category relationships (601 ms)
      ‚úì should cascade delete child categories when parent is deleted (613 ms)
      ‚úì should validate category tree depth (601 ms)
    Complex Relationship Queries
      ‚úì should find all transactions for a user across accounts (589 ms)
      ‚úì should calculate account balance from transactions (599 ms)
      ‚úì should find categories with transaction counts (584 ms)
    Constraint Validation
      ‚úì should enforce unique email constraint (520 ms)
      ‚úì should enforce unique category slug constraint (566 ms)
      ‚úì should enforce transaction amount precision (508 ms)
      ‚úì should enforce enum constraints (476 ms)
    Index Performance
      ‚úì should use indexes for common queries (529 ms)

PASS @money-wise/backend __tests__/unit/auth/controllers/password.controller.spec.ts
  PasswordController
    checkPasswordStrength
      ‚úì should return password strength result (12 ms)
      ‚úì should return weak password result (6 ms)
      ‚úì should detect personal information in password (5 ms)
      ‚úì should validate without personal information context (5 ms)
    changePassword
      ‚úì should change password successfully (5 ms)
      ‚úì should throw error for mismatched passwords (32 ms)
      ‚úì should throw error when rate limited (4 ms)
      ‚úì should throw error for incorrect current password (3 ms)
      ‚úì should handle password change failure from service (3 ms)
      ‚úì should clear rate limit on successful change (2 ms)
      ‚úì should extract IP from various headers (3 ms)
    requestPasswordReset
      ‚úì should request password reset successfully (2 ms)
      ‚úì should handle non-existent email gracefully (4 ms)
      ‚úì should extract IP from x-real-ip header (2 ms)
      ‚úì should handle unknown IP address (3 ms)
    validateResetToken
      ‚úì should validate reset token successfully (5 ms)
      ‚úì should return invalid for bad token (5 ms)
      ‚úì should return invalid for expired token (8 ms)
      ‚úì should pass IP and user agent to service (3 ms)
    resetPassword
      ‚úì should reset password successfully (2 ms)
      ‚úì should throw error for failed reset (3 ms)
      ‚úì should throw error for mismatched passwords (2 ms)
      ‚úì should throw error for weak password (3 ms)
      ‚úì should throw error for expired token (2 ms)
    getPasswordPolicy
      ‚úì should return password policy (3 ms)
    getPasswordStatus
      ‚úì should return password status (2 ms)
      ‚úì should return expired status (2 ms)
      ‚úì should return warning status (2 ms)
      ‚úì should handle negative days until expiration (3 ms)
    IP extraction (getClientIp)
      ‚úì should extract IP from x-forwarded-for header (3 ms)
      ‚úì should extract IP from x-real-ip header (2 ms)
      ‚úì should extract IP from connection.remoteAddress (3 ms)
      ‚úì should extract IP from socket.remoteAddress (9 ms)
      ‚úì should return unknown when no IP is found (4 ms)

PASS @money-wise/backend __tests__/unit/auth/services/password-security.service.spec.ts
  PasswordSecurityService
    hashPassword
      ‚úì should hash password with bcrypt (335 ms)
      ‚úì should hash password with argon2 (175 ms)
    verifyPassword
      ‚úì should verify bcrypt password correctly (981 ms)
      ‚úì should verify argon2 password correctly (571 ms)
      ‚úì should auto-detect hashing algorithm (978 ms)
    validatePassword
      ‚úì should validate strong password (3 ms)
      ‚úì should reject weak password (2 ms)
    isPasswordExpired
      ‚úì should return false for recent password (3 ms)
      ‚úì should return true for old password (3 ms)
    getDaysUntilExpiration
      ‚úì should calculate days until expiration correctly (3 ms)
    shouldWarnPasswordExpiry
      ‚úì should warn when password expires soon (2 ms)
      ‚úì should not warn when password is not expiring soon (2 ms)

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:20 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError setting up 2FA:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:20 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mBadRequestException: User not found[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:20 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError setting up 2FA:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:20 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: QR generation failed[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA setup:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError disabling 2FA:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError checking 2FA status:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError generating new backup codes:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: ECONNREFUSED: Redis connection refused[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError verifying 2FA setup:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:22 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mSyntaxError: Unexpected token 'i', "invalid-json{{{" is not valid JSON[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:23 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError generating new backup codes:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:23 PM [31m  ERROR[39m [38;5;3m[TwoFactorAuthService] [39m[31mError: Redis write failed[39m
PASS @money-wise/backend __tests__/unit/auth/services/two-factor-auth.service.spec.ts
  TwoFactorAuthService
    setupTwoFactor
      ‚úì should generate 2FA setup with secret, QR code, and backup codes (8 ms)
      ‚úì should throw error if user not found (19 ms)
      ‚úì should throw error if QR code generation fails (9 ms)
      ‚úì should store setup data with 10-minute expiration (4 ms)
      ‚úì should generate unique backup codes (3 ms)
    verifyAndEnable2FA
      ‚úì should enable 2FA with valid token (4 ms)
      ‚úì should throw error for invalid token (3 ms)
      ‚úì should throw error if setup data not found (3 ms)
      ‚úì should throw error if setup data expired (1109 ms)
      ‚úì should handle Redis errors gracefully (3 ms)
    verifyTwoFactor
      ‚úì should verify valid TOTP token (2 ms)
      ‚úì should verify valid backup code when TOTP fails (3 ms)
      ‚úì should throw error for already used backup code (3 ms)
      ‚úì should throw error for invalid token and backup code (5 ms)
      ‚úì should throw error if 2FA not enabled (6 ms)
      ‚úì should handle Redis errors gracefully (5 ms)
    disable2FA
      ‚úì should disable 2FA with valid token (5 ms)
      ‚úì should throw error for invalid token when disabling (5 ms)
      ‚úì should handle Redis errors gracefully (5 ms)
    is2FAEnabled
      ‚úì should return true if 2FA is enabled (9 ms)
      ‚úì should return false if 2FA is not enabled (2 ms)
      ‚úì should return false on Redis errors (2 ms)
    generateNewBackupCodes
      ‚úì should generate new backup codes with valid token (3 ms)
      ‚úì should throw error for invalid token when generating new codes (3 ms)
      ‚úì should throw error if 2FA not enabled (3 ms)
      ‚úì should handle Redis errors gracefully (3 ms)
    onModuleDestroy
      ‚úì should close Redis connection on module destroy (3 ms)
    Edge Cases and Advanced Scenarios
      ‚úì should handle backup code exhaustion (all codes used) (5 ms)
      ‚úì should handle concurrent 2FA setup attempts by same user (4 ms)
      ‚úì should handle 2FA verification with Redis connection failure (11 ms)
      ‚úì should handle backup code verification when only 1 code remains (3 ms)
      ‚úì should handle case-insensitive backup code verification (3 ms)
      ‚úì should prevent disabling 2FA with backup code (require TOTP) (3 ms)
      ‚úì should handle malformed 2FA setup data in Redis (4 ms)
      ‚úì should handle setup expiration edge case (expires during verification) (1106 ms)
      ‚úì should generate exactly 10 unique backup codes every time (5 ms)
      ‚úì should handle TOTP token validation at time boundary (clock skew) (4 ms)
      ‚úì should handle new backup code generation when Redis save fails (4 ms)

PASS @money-wise/backend __tests__/unit/accounts/accounts.controller.spec.ts
  AccountsController
    ‚úì should be defined (10 ms)
    create
      ‚úì should create an account for the current user (6 ms)
      ‚úì should create account with default currency if not provided (7 ms)
      ‚úì should create account with optional fields (32 ms)
    findAll
      ‚úì should return all accounts for current user (3 ms)
      ‚úì should return empty array when user has no accounts (3 ms)
      ‚úì should return multiple accounts (3 ms)
    getSummary
      ‚úì should return accounts summary (4 ms)
      ‚úì should return summary with no accounts (4 ms)
    findOne
      ‚úì should return account by ID for owner (4 ms)
      ‚úì should allow admin to access any account (3 ms)
      ‚úì should throw NotFoundException when account not found (21 ms)
      ‚úì should throw ForbiddenException when user tries to access another user account (4 ms)
    getBalance
      ‚úì should return account balance (4 ms)
      ‚úì should return balance with null available balance (3 ms)
      ‚úì should throw ForbiddenException when accessing another user balance (2 ms)
      ‚úì should throw NotFoundException when account not found (3 ms)
    update
      ‚úì should allow user to update own account (2 ms)
      ‚úì should allow admin to update any account (2 ms)
      ‚úì should throw ForbiddenException when non-owner tries to update (12 ms)
      ‚úì should throw NotFoundException when account not found (3 ms)
      ‚úì should update status (2 ms)
      ‚úì should update settings (3 ms)
    remove
      ‚úì should allow user to delete own account (2 ms)
      ‚úì should allow admin to delete any account (2 ms)
      ‚úì should throw ForbiddenException when non-owner tries to delete (4 ms)
      ‚úì should throw NotFoundException when account not found (3 ms)
    syncAccount
      ‚úì should sync Plaid account (3 ms)
      ‚úì should throw ForbiddenException when trying to sync manual account (3 ms)
      ‚úì should throw ForbiddenException when non-owner tries to sync (3 ms)
      ‚úì should throw NotFoundException when account not found (3 ms)

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError generating verification token:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis connection failed[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError verifying email:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Database connection failed[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError resending verification email:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Database error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError checking verification requirement:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Database error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError getting token info:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError cleaning up expired tokens:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError getting verification stats:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mError getting token info:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:27 PM [31m  ERROR[39m [38;5;3m[EmailVerificationService] [39m[31mSyntaxError: Unexpected token 'i', "invalid-json{{{" is not valid JSON[39m
PASS @money-wise/backend __tests__/unit/auth/services/email-verification.service.spec.ts
  EmailVerificationService
    generateVerificationToken
      ‚úì should generate and store verification token for valid user (5 ms)
      ‚úì should set token expiration to 24 hours from creation (2 ms)
      ‚úì should generate unique tokens for multiple calls (2 ms)
      ‚úì should handle Redis errors gracefully during token generation (19 ms)
      ‚úì should store both token data and user reverse lookup (7 ms)
    verifyEmail
      ‚úì should successfully verify email with valid token (3 ms)
      ‚úì should reject invalid token (3 ms)
      ‚úì should reject expired token (3 ms)
      ‚úì should reject token for non-existent user (2 ms)
      ‚úì should reject token if email does not match user (3 ms)
      ‚úì should handle already verified email gracefully (2 ms)
      ‚úì should sanitize user data in response (exclude password) (2 ms)
      ‚úì should handle database errors during verification (2 ms)
    resendVerificationEmail
      ‚úì should resend verification email for valid user (2 ms)
      ‚úì should reject resend for non-existent user (3 ms)
      ‚úì should reject resend for already verified email (2 ms)
      ‚úì should prevent resending if token was sent recently (within 1 hour) (8 ms)
      ‚úì should allow resending if existing token expires soon (less than 1 hour) (3 ms)
      ‚úì should clean up expired existing token before generating new one (3 ms)
      ‚úì should handle database errors during resend (2 ms)
    isVerificationRequired
      ‚úì should return true for unverified user (3 ms)
      ‚úì should return false for verified user (3 ms)
      ‚úì should return true for non-existent user (fail-safe) (2 ms)
      ‚úì should return true on database error (fail-safe) (3 ms)
    getTokenInfo
      ‚úì should return token information for valid token (2 ms)
      ‚úì should return null for non-existent token (2 ms)
      ‚úì should handle Redis errors gracefully (3 ms)
    cleanupExpiredTokens
      ‚úì should delete expired tokens (2 ms)
      ‚úì should return 0 if no expired tokens found (2 ms)
      ‚úì should handle Redis errors gracefully during cleanup (9 ms)
    getVerificationStats
      ‚úì should return correct statistics (3 ms)
      ‚úì should return zero stats on error (2 ms)
    onModuleDestroy
      ‚úì should close Redis connection on module destroy (3 ms)
    Edge Cases and Race Conditions
      ‚úì should handle multiple concurrent token generation requests (3 ms)
      ‚úì should handle token generation with special characters in email (3 ms)
      ‚úì should handle very long email addresses (2 ms)
      ‚úì should handle verification when Redis is slow (timeout scenario) (107 ms)
      ‚úì should handle cleanup when user has abandoned verification (never completed) (3 ms)
      ‚úì should handle getTokenInfo for malformed token data (2 ms)
      ‚úì should handle resend when previous token was manually deleted (3 ms)
      ‚úì should handle stats calculation with no tokens (2 ms)
      ‚úì should handle verification when user status changes between checks (7 ms)

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mFailed to log audit event:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mError: ID generation failed[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] suspicious_activity: anonymous from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708199_v6j52mxf7",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.199Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708199_v6j52mxf7",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.199Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: anonymous from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708213_1ho4fr2nm",
  "eventType": "account_locked",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.213Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708213_1ho4fr2nm",
  "eventType": "account_locked",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.213Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-123 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708245_kjtjttdwg",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "failedAttempts": 5,
    "lockDuration": 3600
  },
  "timestamp": "2025-10-03T11:58:28.245Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708245_kjtjttdwg",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "failedAttempts": 5,
    "lockDuration": 3600
  },
  "timestamp": "2025-10-03T11:58:28.245Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] suspicious_activity: user-123 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708250_pjd2fkjd0",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Multiple failed 2FA attempts from different IPs"
  },
  "timestamp": "2025-10-03T11:58:28.250Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708250_pjd2fkjd0",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "userId": "user-123",
  "email": "test@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Multiple failed 2FA attempts from different IPs"
  },
  "timestamp": "2025-10-03T11:58:28.250Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] suspicious_activity: anonymous from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708254_tx90mymie",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Brute force attack detected"
  },
  "timestamp": "2025-10-03T11:58:28.254Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708254_tx90mymie",
  "eventType": "suspicious_activity",
  "severity": "critical",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {
    "description": "Brute force attack detected"
  },
  "timestamp": "2025-10-03T11:58:28.254Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708266_zz32appvi",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.266Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708266_zz32appvi",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.266Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708269_razf4z1ue",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.269Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708269_razf4z1ue",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.269Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708283_abzp0z3rh",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.283Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708283_abzp0z3rh",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.283Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708288_z8uml5ddb",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.288Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708288_z8uml5ddb",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.288Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708292_1d9ospf9q",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.292Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708292_1d9ospf9q",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.292Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708297_sqfu1iqmr",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.297Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708297_sqfu1iqmr",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.297Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708301_uizoaikid",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.301Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708301_uizoaikid",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.301Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708305_645tjmz2s",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.305Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708305_645tjmz2s",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.305Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708311_uq3y0swir",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.311Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708311_uq3y0swir",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.311Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708315_gtm3zafff",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.315Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708315_gtm3zafff",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.315Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708317_7rm9zy1t1",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.317Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708317_7rm9zy1t1",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.317Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708320_i1vxrdilp",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.320Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708320_i1vxrdilp",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.320Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708324_1h2bd2feq",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.324Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708324_1h2bd2feq",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.324Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708328_qazbmxb2i",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.328Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708328_qazbmxb2i",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.328Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mError querying audit logs:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mTypeError: this.auditLogs is not iterable[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708335_aqagp4cvd",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.335Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708335_aqagp4cvd",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.335Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708339_60ipm8cel",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.339Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708339_60ipm8cel",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.339Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708342_rxw5e6xz6",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.342Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708342_rxw5e6xz6",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.342Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708346_bjljmdczd",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.346Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708346_bjljmdczd",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.346Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708348_mu2f1ubzp",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.348Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708348_mu2f1ubzp",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.348Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708351_4hike1n3u",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.351Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708351_4hike1n3u",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.351Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708355_wh5hvjy70",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.355Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708355_wh5hvjy70",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.355Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708359_lposi5txo",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.359Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708359_lposi5txo",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.359Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708364_ewissjqq8",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.364Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708364_ewissjqq8",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.364Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708368_dj2a92tuo",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.368Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708368_dj2a92tuo",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.368Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mError getting audit stats:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mTypeError: Cannot read properties of null (reading 'filter')[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31m[AUDIT] account_locked: user-2 from 192.168.1.1[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708373_5pdwx4ba6",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.373Z"
}

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mSECURITY ALERT[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:28 PM [31m  ERROR[39m [38;5;3m[AuditLogService] [39m[31mObject:[39m
{
  "id": "audit_1759492708373_5pdwx4ba6",
  "eventType": "account_locked",
  "severity": "critical",
  "userId": "user-2",
  "email": "user2@example.com",
  "ipAddress": "192.168.1.1",
  "userAgent": "Mozilla/5.0",
  "details": {},
  "timestamp": "2025-10-03T11:58:28.373Z"
}

PASS @money-wise/backend __tests__/unit/auth/services/audit-log.service.spec.ts
  AuditLogService
    logEvent
      ‚úì should log a basic audit event (5 ms)
      ‚úì should extract client IP from x-forwarded-for header (2 ms)
      ‚úì should extract client IP from x-real-ip header when x-forwarded-for not available (8 ms)
      ‚úì should fall back to connection.remoteAddress for IP (2 ms)
      ‚úì should use "unknown" when no IP can be determined (2 ms)
      ‚úì should extract session ID from x-session-id header (2 ms)
      ‚úì should extract user-agent from request (3 ms)
      ‚úì should use "unknown" for missing user-agent (3 ms)
      ‚úì should store custom details in audit event (5 ms)
      ‚úì should not throw on logging errors (5 ms)
      ‚úì should cap audit logs at maxLogEntries (10000) (11 ms)
    determineSeverity
      ‚úì should assign CRITICAL severity to suspicious activity (6 ms)
      ‚úì should assign CRITICAL severity to account locked (13 ms)
      ‚úì should assign HIGH severity to login failed (3 ms)
      ‚úì should assign HIGH severity to rate limit exceeded (4 ms)
      ‚úì should assign MEDIUM severity to password change success (3 ms)
      ‚úì should assign LOW severity to login success (4 ms)
    logLoginSuccess
      ‚úì should log successful login with user details (6 ms)
    logLoginFailed
      ‚úì should log failed login attempt with reason (6 ms)
    logAccountLocked
      ‚úì should log account lockout with details (6 ms)
    logSuspiciousActivity
      ‚úì should log suspicious activity with description (4 ms)
      ‚úì should log anonymous suspicious activity (3 ms)
    logPasswordChange
      ‚úì should log successful password change (4 ms)
      ‚úì should log failed password change (3 ms)
    queryLogs
      ‚úì should query all logs without filters (5 ms)
      ‚úì should filter logs by userId (12 ms)
      ‚úì should filter logs by single eventType (5 ms)
      ‚úì should filter logs by multiple eventTypes (6 ms)
      ‚úì should filter logs by single severity (4 ms)
      ‚úì should filter logs by multiple severities (4 ms)
      ‚úì should filter logs by ipAddress (4 ms)
      ‚úì should filter logs by date range (startDate) (4 ms)
      ‚úì should filter logs by date range (endDate) (5 ms)
      ‚úì should filter logs by date range (startDate and endDate) (3 ms)
      ‚úì should sort logs by timestamp (newest first) (2 ms)
      ‚úì should apply pagination with offset and limit (4 ms)
      ‚úì should apply default pagination (limit 100) (3 ms)
      ‚úì should handle errors gracefully (3 ms)
      ‚úì should combine multiple filters (8 ms)
    getAuditStats
      ‚úì should return stats for hour timeframe (3 ms)
      ‚úì should return stats for day timeframe (default) (3 ms)
      ‚úì should count unique users correctly (3 ms)
      ‚úì should count unique IPs correctly (2 ms)
      ‚úì should count events by severity (3 ms)
      ‚úì should handle week timeframe (4 ms)
      ‚úì should handle month timeframe (4 ms)
      ‚úì should exclude events outside timeframe (4 ms)
      ‚úì should handle errors gracefully (5 ms)
      ‚úì should handle empty audit logs (5 ms)
    Edge Cases
      ‚úì should handle multiple events from same user at different IPs (4 ms)
      ‚úì should handle events with empty details (11 ms)
      ‚úì should handle events without userId or email (3 ms)
      ‚úì should generate unique IDs for all events (4 ms)
      ‚úì should handle very large details objects (3 ms)
      ‚úì should handle pagination beyond available logs (3 ms)
      ‚úì should handle concurrent logging of multiple events (4 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/category.repository.spec.ts
  CategoryRepository
    findBySlug
      ‚úì should find category by slug (6 ms)
      ‚úì should return null when category not found (2 ms)
      ‚úì should handle findBySlug errors (19 ms)
    findByType
      ‚úì should find categories by type (active only) (4 ms)
      ‚úì should include inactive categories when requested (2 ms)
      ‚úì should handle findByType errors (3 ms)
    findByStatus
      ‚úì should find categories by status (8 ms)
      ‚úì should handle findByStatus errors (3 ms)
    findRootCategories
      ‚úì should find all root categories (2 ms)
      ‚úì should filter root categories by type (2 ms)
      ‚úì should handle findRootCategories errors (3 ms)
    findChildCategories
      ‚úì should find child categories (active only) (3 ms)
      ‚úì should include inactive children when requested (3 ms)
      ‚úì should handle findChildCategories errors (3 ms)
    findCategoryTree
      ‚úì should find full category tree (2 ms)
      ‚úì should find tree starting from specific parent (2 ms)
      ‚úì should handle findCategoryTree errors (3 ms)
    findCategoriesWithRules
      ‚úì should find categories with rules (2 ms)
      ‚úì should filter by type (2 ms)
      ‚úì should handle findCategoriesWithRules errors (8 ms)
    findDefaultCategories
      ‚úì should find default categories (3 ms)
      ‚úì should filter default categories by type (2 ms)
      ‚úì should handle findDefaultCategories errors (2 ms)
    findSystemCategories
      ‚úì should find system categories (3 ms)
      ‚úì should filter system categories by type (3 ms)
      ‚úì should handle findSystemCategories errors (2 ms)
    searchCategories
      ‚úì should search categories by name and description (3 ms)
      ‚úì should filter search by type (2 ms)
      ‚úì should handle searchCategories errors (2 ms)
    isSlugAvailable
      ‚úì should return true when slug is available (4 ms)
      ‚úì should return false when slug is taken (4 ms)
      ‚úì should exclude specified category from check (2 ms)
      ‚úì should handle isSlugAvailable errors (12 ms)
    updateStatus
      ‚úì should update category status (5 ms)
      ‚úì should return null when category not found (3 ms)
      ‚úì should handle updateStatus errors (4 ms)
    moveCategory
      ‚úì should move category to new parent (3 ms)
      ‚úì should move category to root level (2 ms)
      ‚úì should handle moveCategory errors (2 ms)
    updateSortOrder
      ‚úì should update category sort order (2 ms)
      ‚úì should handle updateSortOrder errors (2 ms)
    getCategoryUsageStats
      ‚úì should get category usage statistics (3 ms)
      ‚úì should handle null values in stats (3 ms)
      ‚úì should handle getCategoryUsageStats errors (2 ms)
    findMatchingCategories
      ‚úì should find matching categories based on keywords (7 ms)
      ‚úì should match by merchant patterns (2 ms)
      ‚úì should match by amount ranges (2 ms)
      ‚úì should return empty array when no matches (3 ms)
      ‚úì should handle findMatchingCategories errors (2 ms)
    archiveAndReassign
      ‚úì should archive category and reassign transactions (3 ms)
      ‚úì should handle archiveAndReassign errors (2 ms)
    createDefaultCategories
      ‚úì should create default categories (3 ms)
      ‚úì should handle createDefaultCategories errors (2 ms)
    updateRules
      ‚úì should update category rules (2 ms)
      ‚úì should handle updateRules errors (2 ms)
    updateMetadata
      ‚úì should update category metadata (3 ms)
      ‚úì should handle updateMetadata errors (2 ms)
    reorderCategories
      ‚úì should reorder categories under parent (8 ms)
      ‚úì should reorder categories at root level (3 ms)
      ‚úì should handle reorderCategories errors (2 ms)
    Edge Cases
      ‚úì should handle empty string slug (2 ms)
      ‚úì should handle special characters in search (3 ms)
      ‚úì should handle large category trees (4 ms)
      ‚úì should handle category with no transactions in usage stats (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/account.repository.spec.ts
  AccountRepository
    findByUserId
      ‚úì should find accounts by user ID (6 ms)
      ‚úì should handle findByUserId errors (24 ms)
    findActiveAccountsByUserId
      ‚úì should find active accounts by user ID (4 ms)
      ‚úì should handle findActiveAccountsByUserId errors (6 ms)
    updateBalance
      ‚úì should update account currentBalance successfully (3 ms)
      ‚úì should return false when no account was updated (7 ms)
      ‚úì should handle updateBalance errors (3 ms)
    incrementBalance
      ‚úì should increment account currentBalance successfully (4 ms)
      ‚úì should return false when no account was updated (2 ms)
      ‚úì should handle incrementBalance errors (2 ms)
      ‚úì should increment account balance (3 ms)
      ‚úì should return false if account not found (4 ms)
      ‚úì should handle incrementBalance errors (3 ms)
    decrementBalance
      ‚úì should decrement account currentBalance successfully (2 ms)
      ‚úì should handle decrementBalance errors (3 ms)
      ‚úì should decrement account balance (3 ms)
      ‚úì should handle decrementBalance errors (3 ms)
    getTotalBalanceForUser
      ‚úì should get total currentBalance for user (4 ms)
      ‚úì should return 0 when no total found (3 ms)
      ‚úì should handle getTotalBalanceForUser errors (3 ms)
    findByPlaidAccountId
      ‚úì should find account by Plaid account ID (3 ms)
      ‚úì should return null when Plaid account not found (2 ms)
      ‚úì should handle findByPlaidAccountId errors (11 ms)
    deactivateAccount
      ‚úì should deactivate account successfully (3 ms)
      ‚úì should return false when no account was deactivated (2 ms)
      ‚úì should handle deactivateAccount errors (3 ms)
    reactivateAccount
      ‚úì should reactivate account successfully (2 ms)
      ‚úì should handle reactivateAccount errors (2 ms)
    findAccountsForSync
      ‚úì should find accounts for sync with user filter (3 ms)
      ‚úì should find all accounts for sync without user filter (2 ms)
      ‚úì should handle findAccountsForSync errors (3 ms)
    getAccountBalancesSummary
      ‚úì should get account currentBalances summary by type (3 ms)
      ‚úì should handle getAccountBalancesSummary errors (2 ms)
    findLowBalanceAccounts
      ‚úì should find low currentBalance accounts with user filter (2 ms)
      ‚úì should handle findLowBalanceAccounts errors (10 ms)
    findByType
      ‚úì should find accounts by type with userId (5 ms)
      ‚úì should find accounts by type without userId (3 ms)
      ‚úì should handle findByType errors (3 ms)
    findByPlaidItemId
      ‚úì should find accounts by Plaid item ID (2 ms)
      ‚úì should return empty array if no accounts found (4 ms)
      ‚úì should handle findByPlaidItemId errors (4 ms)
    updateLastSyncedAt
      ‚úì should update sync timestamp successfully (9 ms)
      ‚úì should return false if account not found (2 ms)
      ‚úì should handle update errors (2 ms)
    findWithTransactions
      ‚úì should find account with transactions and apply limit (3 ms)
      ‚úì should use default limit of 50 (2 ms)
      ‚úì should return null if account not found (2 ms)
      ‚úì should handle errors (2 ms)
    findByCurrency
      ‚úì should find accounts by currency with userId (2 ms)
      ‚úì should find accounts by currency without userId (3 ms)
      ‚úì should handle errors (2 ms)
    groupByInstitution
      ‚úì should group accounts by institution with totals (3 ms)
      ‚úì should return empty array if no accounts found (2 ms)
      ‚úì should handle errors (3 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/base.repository.spec.ts
  BaseRepository
    constructor
      ‚úì should initialize repository with correct entity (5 ms)
    create
      ‚úì should create and save a new entity successfully (7 ms)
      ‚úì should handle creation errors and throw descriptive error (22 ms)
    save
      ‚úì should save an existing entity successfully (4 ms)
      ‚úì should handle save errors (4 ms)
    findById
      ‚úì should find entity by ID successfully (2 ms)
      ‚úì should return null when entity not found (3 ms)
      ‚úì should handle findById errors (3 ms)
    findOne
      ‚úì should find one entity with FindOptionsWhere (3 ms)
      ‚úì should find one entity with FindOneOptions (3 ms)
      ‚úì should return null when no entity found (8 ms)
      ‚úì should handle findOne errors (2 ms)
    find
      ‚úì should find multiple entities with options (2 ms)
      ‚úì should find all entities when no options provided (2 ms)
      ‚úì should handle find errors (3 ms)
    findWithPagination
      ‚úì should return paginated results (2 ms)
      ‚úì should handle pagination with criteria (2 ms)
      ‚úì should handle pagination errors (3 ms)
    update
      ‚úì should update entity successfully (2 ms)
      ‚úì should return null when entity to update not found (2 ms)
      ‚úì should handle update errors (2 ms)
    delete
      ‚úì should delete entity successfully (2 ms)
      ‚úì should return false when no entity was deleted (8 ms)
      ‚úì should handle delete errors (3 ms)
    deleteBy
      ‚úì should delete entities by criteria (4 ms)
      ‚úì should return 0 when no entities match deletion criteria (2 ms)
      ‚úì should handle deleteBy errors (3 ms)
    count
      ‚úì should count entities with criteria (2 ms)
      ‚úì should count all entities when no criteria provided (2 ms)
      ‚úì should handle count errors (5 ms)
    exists
      ‚úì should return true when entity exists (3 ms)
      ‚úì should return false when entity does not exist (4 ms)
      ‚úì should handle exists errors (2 ms)
    bulkInsert
      ‚úì should perform bulk insert successfully (2 ms)
      ‚úì should handle bulk insert errors (3 ms)
    bulkUpdate
      ‚úì should perform bulk update successfully (9 ms)
      ‚úì should return 0 when no entities match update criteria (2 ms)
      ‚úì should handle bulk update errors (2 ms)
    query
      ‚úì should execute raw query successfully (2 ms)
      ‚úì should execute parameterized query (3 ms)
      ‚úì should handle query errors (4 ms)
    softDelete
      ‚úì should soft delete entity successfully (4 ms)
      ‚úì should return false when no entity was soft deleted (5 ms)
      ‚úì should handle soft delete errors (6 ms)
      ‚úì should handle null affected count (5 ms)
    restore
      ‚úì should restore soft deleted entity successfully (2 ms)
      ‚úì should return false when no entity was restored (3 ms)
      ‚úì should handle restore errors (7 ms)
      ‚úì should handle undefined affected count (2 ms)
    deleteMany
      ‚úì should delete multiple entities by criteria (2 ms)
      ‚úì should return 0 affected when no entities deleted (2 ms)
      ‚úì should handle null affected count (2 ms)
      ‚úì should handle deleteMany errors (2 ms)
    findAndCount
      ‚úì should find entities with total count (3 ms)
      ‚úì should find and count all entities without options (2 ms)
      ‚úì should handle empty result set (3 ms)
      ‚úì should handle findAndCount errors (7 ms)
    createBulk
      ‚úì should create multiple entities successfully (2 ms)
      ‚úì should handle empty array (2 ms)
      ‚úì should handle createBulk errors (8 ms)
    updateMany
      ‚úì should update multiple entities successfully (3 ms)
      ‚úì should handle zero updates (2 ms)
      ‚úì should handle null affected count (1 ms)
      ‚úì should handle updateMany errors (2 ms)
    existsBy
      ‚úì should return true when entity exists by criteria (1 ms)
      ‚úì should return false when entity does not exist (1 ms)
      ‚úì should return true when multiple entities match criteria (2 ms)
      ‚úì should handle existsBy errors (2 ms)
    protected methods
      createQueryBuilder
        ‚úì should create query builder with alias (2 ms)
        ‚úì should create query builder without alias (3 ms)
      manager
        ‚úì should access entity manager from repository (2 ms)
    edge cases
      findById with options
        ‚úì should apply FindOneOptions when finding by ID (2 ms)
      delete with undefined affected
        ‚úì should handle undefined affected count in delete (13 ms)
      update partial data
        ‚úì should handle partial entity updates (2 ms)
      findWithPagination edge cases
        ‚úì should handle first page pagination (3 ms)
        ‚úì should handle large page numbers (2 ms)
        ‚úì should handle very large limit values (2 ms)
      count with complex options
        ‚úì should handle count with where and order options (2 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/transaction.repository.spec.ts
  TransactionRepository
    findByAccountId
      ‚úì should find transactions by account ID (8 ms)
      ‚úì should apply date range filters (4 ms)
      ‚úì should apply pagination (3 ms)
      ‚úì should include hidden transactions when requested (3 ms)
      ‚úì should handle findByAccountId errors (26 ms)
    findByCategoryId
      ‚úì should find transactions by category ID (4 ms)
      ‚úì should apply date range and pagination (18 ms)
      ‚úì should handle findByCategoryId errors (4 ms)
    findByUserId
      ‚úì should find transactions by user ID (5 ms)
      ‚úì should apply complex filters (7 ms)
      ‚úì should handle findByUserId errors (4 ms)
    findByPlaidTransactionId
      ‚úì should find transaction by Plaid ID (3 ms)
      ‚úì should return null when Plaid transaction not found (3 ms)
      ‚úì should handle findByPlaidTransactionId errors (4 ms)
    findByType
      ‚úì should find transactions by type (3 ms)
      ‚úì should apply optional filters (3 ms)
      ‚úì should handle findByType errors (2 ms)
    findByStatus
      ‚úì should find transactions by status (10 ms)
      ‚úì should apply optional filters (3 ms)
      ‚úì should handle findByStatus errors (3 ms)
    findBySource
      ‚úì should find transactions by source (3 ms)
      ‚úì should apply optional filters (3 ms)
      ‚úì should handle findBySource errors (2 ms)
    findUncategorized
      ‚úì should find uncategorized transactions (3 ms)
      ‚úì should apply optional filters (3 ms)
      ‚úì should handle findUncategorized errors (3 ms)
    findDuplicates
      ‚úì should find duplicate transactions (4 ms)
      ‚úì should apply duplicate detection options (4 ms)
      ‚úì should handle findDuplicates errors (3 ms)
    findRecent
      ‚úì should find recent transactions (11 ms)
      ‚úì should use custom days and limit (4 ms)
      ‚úì should handle findRecent errors (3 ms)
    searchTransactions
      ‚úì should search transactions by term (3 ms)
      ‚úì should apply search filters (3 ms)
      ‚úì should handle searchTransactions errors (3 ms)
    getTransactionStats
      ‚úì should get transaction statistics (4 ms)
      ‚úì should handle getTransactionStats errors (4 ms)
    updateCategory
      ‚úì should update transaction category (3 ms)
      ‚úì should handle null category (uncategorize) (3 ms)
      ‚úì should return null when transaction not found (3 ms)
      ‚úì should handle updateCategory errors (2 ms)
    updateDescription
      ‚úì should update transaction description (2 ms)
      ‚úì should handle updateDescription errors (8 ms)
    toggleHidden
      ‚úì should toggle hidden status from false to true (3 ms)
      ‚úì should toggle hidden status from true to false (2 ms)
      ‚úì should return null when transaction not found (3 ms)
      ‚úì should handle toggleHidden errors (3 ms)
    addNotes
      ‚úì should add notes to transaction (2 ms)
      ‚úì should handle addNotes errors (2 ms)
    addTags
      ‚úì should add tags to transaction (2 ms)
      ‚úì should handle addTags errors (2 ms)
    getMonthlySpendingByCategory
      ‚úì should throw not implemented error (3 ms)
    createSplit
      ‚úì should throw not implemented error (2 ms)
    bulkCategorize
      ‚úì should throw not implemented error (2 ms)
    findNeedingCategorization
      ‚úì should throw not implemented error (8 ms)
    getCashFlow
      ‚úì should throw not implemented error (3 ms)

PASS @money-wise/backend __tests__/unit/common/interceptors/sentry.interceptor.spec.ts
  SentryInterceptor
    intercept
      ‚úì should create interceptor instance (1 ms)

PASS @money-wise/backend __tests__/unit/core/database/repositories/user.repository.spec.ts
  UserRepository
    findByEmail
      ‚úì should find user by email (case-insensitive) (5 ms)
      ‚úì should convert email to lowercase before querying (9 ms)
      ‚úì should return null when user not found (2 ms)
      ‚úì should handle findByEmail errors (17 ms)
    isEmailTaken
      ‚úì should return true when email is taken (4 ms)
      ‚úì should return false when email is not taken (2 ms)
      ‚úì should exclude specific user when checking email availability (2 ms)
      ‚úì should return true when email exists for different user (3 ms)
      ‚úì should handle isEmailTaken errors (3 ms)
    findByEmailVerificationToken
      ‚úì should return null and log warning (not implemented) (2 ms)
      ‚úì should handle errors in findByEmailVerificationToken (10 ms)
    findByPasswordResetToken
      ‚úì should return null and log warning (not implemented) (2 ms)
      ‚úì should handle errors in findByPasswordResetToken (3 ms)
    markEmailAsVerified
      ‚úì should mark email as verified successfully (3 ms)
      ‚úì should return false when user not found (2 ms)
      ‚úì should return false when affected is undefined (2 ms)
      ‚úì should handle markEmailAsVerified errors (3 ms)
    updatePasswordHash
      ‚úì should update password hash successfully (2 ms)
      ‚úì should return false when user not found (2 ms)
      ‚úì should handle updatePasswordHash errors (2 ms)
    setPasswordResetToken
      ‚úì should return false and log warning (not implemented) (2 ms)
      ‚úì should handle errors in setPasswordResetToken (3 ms)
    clearPasswordResetToken
      ‚úì should return false and log warning (not implemented) (11 ms)
      ‚úì should handle errors in clearPasswordResetToken (2 ms)
    findWithAccounts
      ‚úì should find user with accounts successfully (2 ms)
      ‚úì should return null when user not found (2 ms)
      ‚úì should handle findWithAccounts errors (2 ms)
    findByDateRange
      ‚úì should find users within date range (2 ms)
      ‚úì should return empty array when no users found in range (2 ms)
      ‚úì should handle findByDateRange errors (3 ms)
    getUserStats
      ‚úì should return comprehensive user statistics (4 ms)
      ‚úì should calculate stats with zero users (3 ms)
      ‚úì should calculate stats with all verified users (3 ms)
      ‚úì should use 7-day window for recently created (2 ms)
      ‚úì should handle getUserStats errors (10 ms)
    softDelete
      ‚úì should log soft delete and return true (2 ms)
      ‚úì should handle softDelete errors (4 ms)
    search
      ‚úì should search users by firstName (3 ms)
      ‚úì should search users by lastName (3 ms)
      ‚úì should search users by email (2 ms)
      ‚úì should apply custom limit (2 ms)
      ‚úì should use default limit of 10 (3 ms)
      ‚úì should return empty array when no matches found (2 ms)
      ‚úì should handle partial matches (2 ms)
      ‚úì should handle search errors (2 ms)
      ‚úì should handle special characters in search query (2 ms)
      ‚úì should be case-insensitive (4 ms)

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:34 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:34 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:34 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:34 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:34 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:34 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError validating reset token:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError resetting password:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Database error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mFailed to generate password reset token for test@example.com:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mTypeError: tokenData.createdAt.getTime is not a function[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError getting password reset stats:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError cleaning up expired tokens:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError revoking user tokens:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:35 PM [31m  ERROR[39m [38;5;3m[PasswordResetService] [39m[31mError: Redis error[39m
PASS @money-wise/backend __tests__/unit/auth/services/password-reset.service.spec.ts
  PasswordResetService
    Token Generation (requestPasswordReset)
      ‚úì should generate and store reset token for valid user (8 ms)
      ‚úì should prevent multiple token generation within 5 minutes (13 ms)
      ‚úì should set token expiration to 30 minutes from creation (5 ms)
      ‚úì should store token data with metadata in Redis (3 ms)
      ‚úì should clean up expired tokens before creating new one (3 ms)
      ‚úì should handle database errors gracefully during token creation (4 ms)
      ‚úì should log token generation in audit trail (3 ms)
    Rate Limiting
      ‚úì should reject request when rate limit exceeded (4 ms)
      ‚úì should reject request when account is locked out (4 ms)
      ‚úì should log rate limit events in audit trail (3 ms)
    User Enumeration Prevention
      ‚úì should return same success message for non-existent users (11 ms)
      ‚úì should return same success message for inactive users (3 ms)
      ‚úì should record failed attempts for non-existent users (3 ms)
    Token Validation (validateResetToken)
      ‚úì should accept valid unexpired tokens (4 ms)
      ‚úì should reject expired tokens (4 ms)
      ‚úì should reject already-used tokens (3 ms)
      ‚úì should reject invalid token format (4 ms)
      ‚úì should reject tokens for non-existent users (3 ms)
      ‚úì should reject tokens for inactive users (3 ms)
      ‚úì should handle validation errors gracefully (4 ms)
    Password Reset (resetPassword)
      ‚úì should reset password successfully with valid token (4 ms)
      ‚úì should reject mismatched passwords (3 ms)
      ‚úì should reject weak passwords (4 ms)
      ‚úì should mark token as used after successful reset (5 ms)
      ‚úì should clear rate limits after successful reset (5 ms)
      ‚úì should log successful password reset in audit trail (4 ms)
      ‚úì should return email verification requirement status (7 ms)
      ‚úì should handle password change errors gracefully (6 ms)
    Token Management
      ‚úì should handle token cleanup errors gracefully (4 ms)
      ‚úì should not cleanup recent tokens (< 5 minutes old) (5 ms)
    Statistics and Maintenance
      ‚úì should return password reset statistics (5 ms)
      ‚úì should handle errors in statistics gracefully (15 ms)
      ‚úì should cleanup all expired tokens (4 ms)
      ‚úì should handle cleanup errors gracefully (4 ms)
      ‚úì should revoke all tokens for a specific user (4 ms)
      ‚úì should handle revocation when no tokens exist (4 ms)
      ‚úì should handle revocation errors gracefully (5 ms)
    Resource Cleanup
      ‚úì should cleanup Redis connection on module destroy (4 ms)

PASS @money-wise/backend __tests__/unit/auth/auth.service.spec.ts
  AuthService
    register
      ‚úì should register a new user successfully (14 ms)
      ‚úì should throw ConflictException if user already exists (19 ms)
    login
      ‚úì should login user successfully (5 ms)
      ‚úì should throw UnauthorizedException if user not found (5 ms)
      ‚úì should throw UnauthorizedException if password is invalid (3 ms)
      ‚úì should throw UnauthorizedException if user is not active (3 ms)
    refreshToken
      ‚úì should refresh token successfully with valid refresh token (4 ms)
      ‚úì should throw UnauthorizedException with invalid refresh token (14 ms)
      ‚úì should throw UnauthorizedException if user not found (5 ms)
      ‚úì should throw UnauthorizedException if user is not active (5 ms)
      ‚úì should throw UnauthorizedException with expired refresh token (4 ms)
    validateUser
      ‚úì should return user if valid (4 ms)
      ‚úì should throw UnauthorizedException if user not found (3 ms)
      ‚úì should throw UnauthorizedException if user is not active (4 ms)
    generateAuthResponse
      ‚úì should generate proper auth response with tokens (5 ms)
    error scenarios
      ‚úì should handle password hashing errors during registration (5 ms)
      ‚úì should handle database errors during user creation (3 ms)
      ‚úì should handle password verification errors during login (4 ms)

[31m[Nest] 2080716  - [39m10/03/2025, 1:58:36 PM [31m  ERROR[39m [38;5;3m[AuthSecurityService] [39m[31mLogin error:[39m
[31m[Nest] 2080716  - [39m10/03/2025, 1:58:36 PM [31m  ERROR[39m [38;5;3m[AuthSecurityService] [39m[31mTypeError: Cannot read properties of undefined (reading 'isLocked')[39m
PASS @money-wise/backend __tests__/unit/auth/auth-security.service.spec.ts
  AuthSecurityService
    ‚úì should be defined (8 ms)
    register
      ‚úì should successfully register a new user (6 ms)
      ‚úì should throw ConflictException if user already exists (33 ms)
      ‚úì should throw BadRequestException for weak password (6 ms)
    login
      ‚úì should successfully login with valid credentials (24 ms)
      ‚úì should throw UnauthorizedException if account is locked (6 ms)
      ‚úì should throw UnauthorizedException for invalid credentials (5 ms)
      ‚úì should record failed attempt on invalid password (6 ms)
    changePassword
      ‚úì should successfully change password (8 ms)
      ‚úì should throw UnauthorizedException for invalid current password (6 ms)
      ‚úì should throw BadRequestException for weak new password (6 ms)
      ‚úì should throw BadRequestException if new password is same as current (6 ms)
    requestPasswordReset
      ‚úì should request password reset (5 ms)
    verifyEmail
      ‚úì should verify email successfully (5 ms)
    checkPasswordStrength
      ‚úì should return password strength analysis (4 ms)
    refreshToken
      ‚úì should successfully refresh token (23 ms)
      ‚úì should throw UnauthorizedException for invalid token (6 ms)

PASS @money-wise/backend __tests__/unit/users/users.controller.spec.ts
  UsersController
    ‚úì should be defined (6 ms)
    findAll
      ‚úì should return paginated users for admin (5 ms)
      ‚úì should support custom pagination parameters (4 ms)
      ‚úì should use default pagination when not provided (3 ms)
    getCurrentUser
      ‚úì should return current user profile (3 ms)
    getStats
      ‚úì should return user statistics (3 ms)
    findOne
      ‚úì should return user by ID (2 ms)
      ‚úì should throw NotFoundException when user not found (11 ms)
    update
      ‚úì should allow user to update own profile (9 ms)
      ‚úì should allow admin to update any user profile (3 ms)
      ‚úì should throw ForbiddenException when non-admin tries to update another user (3 ms)
      ‚úì should throw ConflictException when email already exists (2 ms)
      ‚úì should throw NotFoundException when user not found (3 ms)
    updateStatus
      ‚úì should allow admin to update user status (5 ms)
      ‚úì should throw ForbiddenException when non-admin tries to update status (4 ms)
      ‚úì should throw NotFoundException when user not found (2 ms)
      ‚úì should support all status transitions (3 ms)
    remove
      ‚úì should allow admin to delete user (3 ms)
      ‚úì should throw ForbiddenException when non-admin tries to delete user (2 ms)
      ‚úì should throw NotFoundException when user not found (3 ms)

PASS @money-wise/backend __tests__/unit/auth/jwt.strategy.spec.ts
  JwtStrategy
    constructor
      ‚úì should be defined (4 ms)
      ‚úì should configure strategy with correct options (2 ms)
    validate
      ‚úì should return user for valid payload (3 ms)
      ‚úì should throw UnauthorizedException when user validation fails (8 ms)
      ‚úì should throw UnauthorizedException with custom message for invalid token (3 ms)
      ‚úì should handle payload with different user roles (2 ms)
      ‚úì should handle payload with missing fields (8 ms)
      ‚úì should handle payload with invalid user ID format (4 ms)
      ‚úì should handle null or undefined payload gracefully (3 ms)
      ‚úì should handle empty payload object (3 ms)
      ‚úì should propagate specific error messages from AuthService (2 ms)
      ‚úì should handle concurrent validation requests (3 ms)
    error scenarios
      ‚úì should handle AuthService throwing non-UnauthorizedException errors (2 ms)
      ‚úì should handle AuthService returning null unexpectedly (2 ms)
      ‚úì should handle malformed JWT payload structure (3 ms)

PASS @money-wise/backend __tests__/unit/auth/jwt-auth.guard.spec.ts
  JwtAuthGuard
    canActivate
      ‚úì should return true for public routes (4 ms)
      ‚úì should call super.canActivate for protected routes (2 ms)
      ‚úì should handle undefined public key (3 ms)
      ‚úì should properly check method and class decorators (4 ms)
    handleRequest
      ‚úì should return user when no error and user exists (4 ms)
      ‚úì should throw UnauthorizedException when error exists (7 ms)
      ‚úì should throw UnauthorizedException when user is null (3 ms)
      ‚úì should throw UnauthorizedException when user is undefined (9 ms)
      ‚úì should throw custom UnauthorizedException with proper message (2 ms)
      ‚úì should prioritize original error over missing user (2 ms)
      ‚úì should handle falsy user values (3 ms)
      ‚úì should handle truthy user values (3 ms)
    integration scenarios
      ‚úì should handle public route with missing user gracefully (3 ms)
      ‚úì should handle protected route with valid token (3 ms)

PASS @money-wise/backend __tests__/unit/core/health/health.controller.spec.ts
  HealthController
    ‚úì should be defined (5 ms)
    getHealth
      ‚úì should return basic health status (3 ms)
      ‚úì should return consistent timestamp format (2 ms)
      ‚úì should return positive uptime (3 ms)
      ‚úì should return memory usage (10 ms)
    getDetailedHealth
      ‚úì should return detailed health with services status (4 ms)
      ‚úì should include database response time (4 ms)
    getReadiness
      ‚úì should return readiness status (3 ms)
    getLiveness
      ‚úì should return liveness status (2 ms)

PASS @money-wise/backend __tests__/unit/auth/services/password-strength.service.spec.ts
  PasswordStrengthService
    calculateStrength
      ‚úì should return very weak for simple passwords (4 ms)
      ‚úì should return strong for complex passwords (7 ms)
      ‚úì should detect common passwords (2 ms)
      ‚úì should detect personal information in password (1 ms)
      ‚úì should detect repeating characters (2 ms)
      ‚úì should detect sequential characters (2 ms)
    validatePolicy
      ‚úì should validate minimum length requirement (1 ms)
      ‚úì should validate character requirements (1 ms)
      ‚úì should pass for valid passwords (2 ms)

PASS @money-wise/backend __tests__/unit/docs/openapi.spec.ts
  OpenAPI Specification
    ‚úì should generate valid OpenAPI spec (1 ms)

PASS @money-wise/backend __tests__/unit/common/decorators/sentry-transaction.decorator.spec.ts
  SentryTransactionDecorator
    withSentryTransaction
      ‚úì should wrap function with Sentry transaction (3 ms)
      ‚úì should handle errors in wrapped function (5 ms)
    SentryTransactionManager
      ‚úì should manage transaction lifecycle

Test Suites: 25 passed, 25 total
Tests:       735 passed, 735 total
Snapshots:   0 total
Time:        59.026 s
Ran all test suites matching /__tests__\/unit/i.
