
> @money-wise/backend@0.1.0 test /home/nemesi/dev/money-wise/apps/backend
> jest --passWithNoTests

PASS @money-wise/backend src/auth/auth.service.spec.ts (6.061 s)
  AuthService
    register
      ✓ should register a new user successfully (15 ms)
      ✓ should throw ConflictException if user already exists (15 ms)
    login
      ✓ should login user successfully (5 ms)
      ✓ should throw UnauthorizedException if user not found (5 ms)
      ✓ should throw UnauthorizedException if password is invalid (4 ms)
      ✓ should throw UnauthorizedException if user is not active (3 ms)
    validateUser
      ✓ should return user if valid (3 ms)
      ✓ should throw UnauthorizedException if user not found (3 ms)
      ✓ should throw UnauthorizedException if user is not active (2 ms)

PASS @money-wise/backend src/core/database/repositories/__tests__/base.repository.spec.ts
  BaseRepository
    constructor
      ✓ should initialize repository with correct entity (8 ms)
    create
      ✓ should create and save a new entity successfully (4 ms)
      ✓ should handle creation errors and throw descriptive error (19 ms)
    save
      ✓ should save an existing entity successfully (2 ms)
      ✓ should handle save errors (4 ms)
    findById
      ✓ should find entity by ID successfully (3 ms)
      ✓ should return null when entity not found (2 ms)
      ✓ should handle findById errors (3 ms)
    findOne
      ✓ should find one entity with FindOptionsWhere (2 ms)
      ✓ should find one entity with FindOneOptions (3 ms)
      ✓ should handle findOne errors (2 ms)
    find
      ✓ should find multiple entities with options (2 ms)
      ✓ should find all entities when no options provided (2 ms)
      ✓ should handle find errors (3 ms)
    findWithPagination
      ✓ should return paginated results (2 ms)
      ✓ should handle pagination with criteria (8 ms)
      ✓ should handle pagination errors (4 ms)
    update
      ✓ should update entity successfully (3 ms)
      ✓ should return null when entity to update not found (2 ms)
      ✓ should handle update errors (3 ms)
    delete
      ✓ should delete entity successfully (3 ms)
      ✓ should return false when no entity was deleted (2 ms)
      ✓ should handle delete errors (2 ms)
    deleteBy
      ✓ should delete entities by criteria (2 ms)
      ✓ should handle deleteBy errors (2 ms)
    count
      ✓ should count entities with criteria (2 ms)
      ✓ should count all entities when no criteria provided (3 ms)
      ✓ should handle count errors (11 ms)
    exists
      ✓ should return true when entity exists (3 ms)
      ✓ should return false when entity does not exist (3 ms)
      ✓ should handle exists errors (3 ms)
    bulkInsert
      ✓ should perform bulk insert successfully (2 ms)
      ✓ should handle bulk insert errors (2 ms)
    bulkUpdate
      ✓ should perform bulk update successfully (2 ms)
      ✓ should handle bulk update errors (2 ms)
    query
      ✓ should execute raw query successfully (2 ms)
      ✓ should execute parameterized query (2 ms)
      ✓ should handle query errors (4 ms)

PASS @money-wise/backend src/core/health/health.controller.spec.ts
  HealthController
    ✓ should be defined (6 ms)
    getHealth
      ✓ should return basic health status (3 ms)
      ✓ should return consistent timestamp format (4 ms)
      ✓ should return positive uptime (3 ms)
      ✓ should return memory usage (4 ms)
    getDetailedHealth
      ✓ should return detailed health with services status (7 ms)
      ✓ should include database response time (7 ms)
    getReadiness
      ✓ should return readiness status (3 ms)
    getLiveness
      ✓ should return liveness status (2 ms)

PASS @money-wise/backend src/core/database/repositories/__tests__/integration/repositories.integration.spec.ts
  Repository Integration Tests
    Repository Pattern Integration
      ✓ should have repositories properly exported from index (445 ms)
      ✓ should have repository module and injection tokens exported (1 ms)
      ✓ should validate repository structure integrity (1 ms)
      ✓ should validate test coverage completeness (1 ms)
    Repository Pattern Compliance
      ✓ should document zero-tolerance validation achievements (1 ms)
      ✓ should validate atomic commit compliance (1 ms)

PASS @money-wise/backend src/core/database/repositories/__tests__/user.repository.spec.ts
  UserRepository
    findByEmail
      ✓ should find user by email with case insensitivity (5 ms)
      ✓ should return null when user not found (2 ms)
      ✓ should handle findByEmail errors (16 ms)
    isEmailTaken
      ✓ should return true when email is taken (8 ms)
      ✓ should return false when email is not taken (2 ms)
      ✓ should exclude specific user when checking email availability (2 ms)
      ✓ should handle isEmailTaken errors (3 ms)
    findByEmailVerificationToken
      ✓ should return null for email verification token (not implemented) (2 ms)
      ✓ should handle findByEmailVerificationToken errors (3 ms)
    findByPasswordResetToken
      ✓ should return null for password reset token (not implemented) (2 ms)
      ✓ should handle findByPasswordResetToken errors (4 ms)
    markEmailAsVerified
      ✓ should mark email as verified successfully (3 ms)
      ✓ should return false when no user was updated (3 ms)
      ✓ should handle markEmailAsVerified errors (8 ms)
    updatePasswordHash
      ✓ should update password hash successfully (3 ms)
      ✓ should return false when no user was updated (2 ms)
      ✓ should handle updatePasswordHash errors (2 ms)
    setPasswordResetToken
      ✓ should return false for password reset token (not implemented) (2 ms)
      ✓ should handle setPasswordResetToken errors (2 ms)
    clearPasswordResetToken
      ✓ should return false for clear password reset token (not implemented) (2 ms)
      ✓ should handle clearPasswordResetToken errors (2 ms)
    findWithAccounts
      ✓ should find user with their accounts (2 ms)
      ✓ should return null when user not found (2 ms)
      ✓ should handle findWithAccounts errors (4 ms)
    findByDateRange
      ✓ should find users within date range (4 ms)
      ✓ should handle findByDateRange errors (3 ms)
    getUserStats
      ✓ should return user statistics (7 ms)
      ✓ should handle getUserStats errors (3 ms)
    softDelete
      ✓ should log soft delete request (2 ms)
      ✓ should handle softDelete errors (3 ms)
    search
      ✓ should search users by first name, last name, and email (3 ms)
      ✓ should use default limit when not provided (4 ms)
      ✓ should handle search errors (4 ms)

FAIL @money-wise/backend src/core/database/repositories/__tests__/account.repository.spec.ts
  AccountRepository
    findByUserId
      ✓ should find accounts by user ID (11 ms)
      ✓ should handle findByUserId errors (20 ms)
    findActiveAccountsByUserId
      ✓ should find active accounts by user ID (4 ms)
      ✓ should handle findActiveAccountsByUserId errors (6 ms)
    updateBalance
      ✓ should update account currentBalance successfully (4 ms)
      ✓ should return false when no account was updated (12 ms)
      ✕ should handle updateBalance errors (16 ms)
    incrementBalance
      ✓ should increment account currentBalance successfully (3 ms)
      ✓ should return false when no account was updated (2 ms)
      ✕ should handle incrementBalance errors (3 ms)
    decrementBalance
      ✓ should decrement account currentBalance successfully (3 ms)
      ✕ should handle decrementBalance errors (4 ms)
    getTotalBalanceForUser
      ✓ should get total currentBalance for user (3 ms)
      ✓ should return 0 when no total found (3 ms)
      ✕ should handle getTotalBalanceForUser errors (4 ms)
    findByPlaidAccountId
      ✓ should find account by Plaid account ID (7 ms)
      ✓ should return null when Plaid account not found (2 ms)
      ✓ should handle findByPlaidAccountId errors (3 ms)
    deactivateAccount
      ✓ should deactivate account successfully (3 ms)
      ✓ should return false when no account was deactivated (2 ms)
      ✓ should handle deactivateAccount errors (3 ms)
    reactivateAccount
      ✓ should reactivate account successfully (3 ms)
      ✓ should handle reactivateAccount errors (3 ms)
    findAccountsForSync
      ✓ should find accounts for sync with user filter (3 ms)
      ✓ should find all accounts for sync without user filter (2 ms)
      ✓ should handle findAccountsForSync errors (3 ms)
    getAccountBalancesSummary
      ✓ should get account currentBalances summary by type (3 ms)
      ✕ should handle getAccountBalancesSummary errors (11 ms)
    findLowBalanceAccounts
      ✓ should find low currentBalance accounts with user filter (3 ms)
      ✕ should handle findLowBalanceAccounts errors (5 ms)

  ● AccountRepository › updateBalance › should handle updateBalance errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to update account currentBalance: Balance update failed"
    Received message:   "Failed to update account balance: Balance update failed"

          91 |     } catch (error) {
          92 |       this.logger.error(`Failed to update account balance: ${error.message}`, error.stack);
        > 93 |       throw new Error(`Failed to update account balance: ${error.message}`);
             |             ^
          94 |     }
          95 |   }
          96 |

      at AccountRepository.updateBalance (src/core/database/repositories/impl/account.repository.ts:93:13)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:176:7)
      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:176:85)

  ● AccountRepository › incrementBalance › should handle incrementBalance errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to increment account currentBalance: Increment failed"
    Received message:   "Failed to increment account balance: Increment failed"

          107 |     } catch (error) {
          108 |       this.logger.error(`Failed to increment account balance: ${error.message}`, error.stack);
        > 109 |       throw new Error(`Failed to increment account balance: ${error.message}`);
              |             ^
          110 |     }
          111 |   }
          112 |

      at AccountRepository.incrementBalance (src/core/database/repositories/impl/account.repository.ts:109:13)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:210:7)
      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:210:87)

  ● AccountRepository › decrementBalance › should handle decrementBalance errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to decrement account currentBalance: Decrement failed"
    Received message:   "Failed to decrement account balance: Decrement failed"

          123 |     } catch (error) {
          124 |       this.logger.error(`Failed to decrement account balance: ${error.message}`, error.stack);
        > 125 |       throw new Error(`Failed to decrement account balance: ${error.message}`);
              |             ^
          126 |     }
          127 |   }
          128 |

      at AccountRepository.decrementBalance (src/core/database/repositories/impl/account.repository.ts:125:13)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:234:7)
      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:234:87)

  ● AccountRepository › getTotalBalanceForUser › should handle getTotalBalanceForUser errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to get total currentBalance: Total currentBalance query failed"
    Received message:   "Failed to get total balance: Total currentBalance query failed"

          139 |     } catch (error) {
          140 |       this.logger.error(`Failed to get total balance: ${error.message}`, error.stack);
        > 141 |       throw new Error(`Failed to get total balance: ${error.message}`);
              |             ^
          142 |     }
          143 |   }
          144 |

      at AccountRepository.getTotalBalanceForUser (src/core/database/repositories/impl/account.repository.ts:141:13)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:269:7)
      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:269:85)

  ● AccountRepository › getAccountBalancesSummary › should handle getAccountBalancesSummary errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to get account currentBalances summary: Summary query failed"
    Received message:   "Failed to get account balances summary: Summary query failed"

          166 |     } catch (error) {
          167 |       this.logger.error(`Failed to get account balances summary: ${error.message}`, error.stack);
        > 168 |       throw new Error(`Failed to get account balances summary: ${error.message}`);
              |             ^
          169 |     }
          170 |   }
          171 |

      at AccountRepository.getAccountBalancesSummary (src/core/database/repositories/impl/account.repository.ts:168:13)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:446:7)
      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:446:88)

  ● AccountRepository › findLowBalanceAccounts › should handle findLowBalanceAccounts errors

    expect(received).rejects.toThrow(expected)

    Expected substring: "Failed to find low currentBalance accounts: Low currentBalance query failed"
    Received message:   "Failed to find low balance accounts: Low currentBalance query failed"

          271 |     } catch (error) {
          272 |       this.logger.error(`Failed to find low balance accounts: ${error.message}`, error.stack);
        > 273 |       throw new Error(`Failed to find low balance accounts: ${error.message}`);
              |             ^
          274 |     }
          275 |   }
          276 |

      at AccountRepository.findLowBalanceAccounts (src/core/database/repositories/impl/account.repository.ts:273:13)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:477:7)
      at Object.toThrow (../../node_modules/.pnpm/expect@29.7.0/node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (src/core/database/repositories/__tests__/account.repository.spec.ts:477:75)

Test Suites: 1 failed, 5 passed, 6 total
Tests:       6 failed, 119 passed, 125 total
Snapshots:   0 total
Time:        9.752 s
Ran all test suites.
 ELIFECYCLE  Test failed. See above for more details.
