# Application Configuration
# ⚠️ NODE_ENV is managed automatically - DO NOT SET MANUALLY!
PORT=3001
APP_NAME=MoneyWise Backend
APP_VERSION=0.1.0
API_PREFIX=api
CORS_ORIGIN=http://localhost:3000

# Database Configuration (TimescaleDB)
# IMPORTANT: Must match docker-compose.dev.yml settings
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=password
DB_NAME=moneywise
DB_SCHEMA=public
DB_SYNCHRONIZE=false
DB_LOGGING=true

# TimescaleDB-specific Configuration
TIMESCALEDB_ENABLED=true
TIMESCALEDB_COMPRESSION_ENABLED=true
TIMESCALEDB_RETENTION_ENABLED=true
TIMESCALEDB_CHUNK_TIME_INTERVAL=1d
TIMESCALEDB_COMPRESSION_AFTER=7d
TIMESCALEDB_RETENTION_AFTER=7y

# JWT Configuration
JWT_ACCESS_SECRET=your-super-secret-jwt-access-key-change-in-production
JWT_ACCESS_EXPIRES_IN=15m
JWT_REFRESH_SECRET=your-super-secret-jwt-refresh-key-change-in-production
JWT_REFRESH_EXPIRES_IN=7d

# Cookie & CSRF Protection
# SESSION_SECRET: Used for cookie signing (minimum 64 characters recommended)
SESSION_SECRET=your-super-secret-session-key-min-64-chars-change-in-production-use-crypto-random
# CSRF_SECRET: Used for CSRF token signing (optional, falls back to SESSION_SECRET)
CSRF_SECRET=your-super-secret-csrf-key-min-64-chars-change-in-production-use-crypto-random

# Redis Configuration (Session Storage & Caching)
# IMPORTANT: Required for health checks and session management
# Development: Use local Redis instance (docker-compose.dev.yml)
# Staging/Production: Use managed Redis service (AWS ElastiCache, Redis Cloud, etc.)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=  # Leave empty for local dev, set in staging/production
REDIS_DB=0  # Redis database number (0-15)

# Sentry Error Tracking Configuration
# IMPORTANT: Use separate Sentry projects for each environment (dev/staging/prod)
# See docs/development/sentry-configuration.md for complete setup guide
#
# Get your DSN from: https://sentry.io/settings/{organization}/projects/{project}/keys/
# Example: SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0
SENTRY_DSN=

# Environment-Specific Configuration:
# - development: Use moneywise-development project DSN, 100% sampling
# - staging: Use moneywise-staging project DSN, 50% sampling
# - production: Use moneywise-production project DSN, 10% sampling
SENTRY_ENVIRONMENT=

# Release Tracking (optional but recommended):
# - Development: dev-local
# - Staging: moneywise@$(git rev-parse --short HEAD)
# - Production: moneywise@{version} (match package.json)
SENTRY_RELEASE=

# CloudWatch Monitoring Configuration
CLOUDWATCH_ENABLED=false
CLOUDWATCH_NAMESPACE=MoneyWise/Backend
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Monitoring Configuration
METRICS_ENABLED=true
METRICS_FLUSH_INTERVAL=30000
HEALTH_CHECK_ENABLED=true

# Email Verification Configuration
# ================================================
# Security and rate limiting settings for email verification flow
# These values control token lifetime, rate limits, and timing attack prevention

# Token Validity Period (hours)
# How long a verification token remains valid after generation
# Recommended: 24 hours for typical applications
# Range: 1-720 hours (30 days max)
EMAIL_VERIFICATION_TOKEN_EXPIRY_HOURS=24

# Minimum Token Validity (hours)
# Minimum time token must remain valid after generation
# Prevents tokens from expiring too quickly in edge cases
# Recommended: 1 hour
# Range: 0.5-24 hours
EMAIL_VERIFICATION_MIN_VALIDITY_HOURS=1

# Resend Rate Limit (attempts per hour)
# Maximum number of times users can request a new verification email per hour
# Prevents email flooding/spam while allowing legitimate retries
# Recommended: 3 attempts per hour
# Range: 1-10 attempts
EMAIL_VERIFICATION_RESEND_RATE_LIMIT=3

# Verification Rate Limit (attempts per token per hour)
# Maximum verification attempts per token to prevent brute force attacks
# Each token has 5 attempts per hour before being rate limited
# Security Note: With 5 attempts/hour, attacking single token needs:
#   (32^64 / 5) = 3.7e97 hours to guess - effectively impossible
# Recommended: 5 attempts per hour
# Range: 1-100 attempts
EMAIL_VERIFICATION_VERIFICATION_RATE_LIMIT=5

# Timing Attack Prevention - Minimum Delay (milliseconds)
# Minimum artificial delay added to all error responses
# Prevents timing-based attacks that measure response time to infer token validity
# Recommended: 100ms
# Range: 50-500ms
EMAIL_VERIFICATION_TIMING_ATTACK_DELAY_MIN_MS=100

# Timing Attack Prevention - Maximum Delay (milliseconds)
# Maximum artificial delay added to all error responses
# Combined with minimum delay, creates randomized 100-300ms delay window
# Prevents attackers from using timing measurements to enumerate tokens
# Recommended: 300ms
# Range: 100-1000ms (must be > EMAIL_VERIFICATION_TIMING_ATTACK_DELAY_MIN_MS)
EMAIL_VERIFICATION_TIMING_ATTACK_DELAY_MAX_MS=300

# Banking Integration Configuration
# ================================================
# SaltEdge Open Banking API Integration (PSD2 compliant)
#
# Setup Instructions:
# 1. Create account at: https://www.saltedge.com/client_users/sign_in
# 2. Navigate to Settings > API Access
# 3. Copy App ID, Client ID, and Secret
# 4. Set BANKING_INTEGRATION_ENABLED=true to enable
#
# Documentation: https://docs.saltedge.com/account_information/v5/
# Supported countries: 46+ (EU, UK, US, etc.)
# Supported banks: 5000+ financial institutions

# Enable/disable banking integration
BANKING_INTEGRATION_ENABLED=false

# SaltEdge API Credentials
# Get from: https://www.saltedge.com/clients/profile/secrets
SALTEDGE_CLIENT_ID=
SALTEDGE_SECRET=
SALTEDGE_APP_ID=

# SaltEdge API URL (default: production API)
# Development: https://www.saltedge.com/api/v5 (pending stage with fake connections)
# Production: https://www.saltedge.com/api/v5 (live stage with real banks)
SALTEDGE_API_URL=https://www.saltedge.com/api/v5

# Application URL (for OAuth callbacks)
# Development: http://localhost:3000
# Staging: https://staging.moneywise.app
# Production: https://app.moneywise.io
APP_URL=http://localhost:3000