# MoneyWise Security Vulnerability Analysis
**Generated:** 2025-10-18
**Status:** CRITICAL - 5 Open Vulnerabilities

## Executive Summary

MoneyWise has **5 active security vulnerabilities** across 3 packages:
- **3 HIGH severity** (axios DoS, axios SSRF, ip SSRF)
- **2 MEDIUM severity** (axios CSRF, validator URL bypass)

**CRITICAL FINDING:** The `validator` vulnerability (CVE-2025-56200) has **NO FIX AVAILABLE** as of October 2025. Version 13.15.15 is the latest and is still vulnerable.

**URGENT:** The `ip` package is **UNMAINTAINED** with no official fix. Migration to `@webpod/ip` is required.

---

## Vulnerability Details

### 1. Axios Vulnerabilities (3 CVEs)

#### GHSA-4hjh-wcwx-xvwj - DoS via Data URL Decode (HIGH)
- **CVE:** CVE-2025-58754
- **Severity:** 7.5 (High)
- **Affected Versions:** >= 1.0.0, < 1.12.0
- **Current Version:** 1.12.2 ‚úÖ SAFE
- **Fix Version:** >= 1.12.0
- **Impact:** Attackers can supply large data: URIs causing unbounded memory allocation and process crash
- **Status:** ‚úÖ ALREADY FIXED (current version 1.12.2)

#### GHSA-jr5f-v2jv-69x6 - SSRF & Credential Leakage (HIGH)
- **CVE:** CVE-2025-27152
- **Severity:** 7.7 (High)
- **Affected Versions:** >= 1.0.0, < 1.8.2
- **Current Version:** 1.12.2 ‚úÖ SAFE
- **Fix Version:** >= 1.8.2
- **Impact:** Absolute URLs bypass baseURL, exposing credentials in client configuration
- **Status:** ‚úÖ ALREADY FIXED (current version 1.12.2)

#### GHSA-wf5p-g6vw-rhxx - CSRF Token Leakage (MEDIUM)
- **CVE:** CVE-2023-45857
- **Severity:** MEDIUM
- **Affected Versions:** >= 1.0.0, < 1.6.0
- **Current Version:** 1.12.2 ‚úÖ SAFE
- **Fix Version:** >= 1.6.0
- **Impact:** XSRF-TOKEN leaked in X-XSRF-TOKEN header to all hosts
- **Status:** ‚úÖ ALREADY FIXED (current version 1.12.2)

**Axios Conclusion:** All axios vulnerabilities are already resolved. Current version 1.12.2 is safe.

---

### 2. Validator.js Vulnerability (CRITICAL - NO FIX)

#### GHSA-9965-vmph-33xx - isURL() Validation Bypass (MEDIUM)
- **CVE:** CVE-2025-56200
- **Severity:** MEDIUM
- **Affected Versions:** <= 13.15.15
- **Current Version:** 13.15.15 (via pnpm override)
- **Fix Version:** ‚ùå NONE AVAILABLE (as of 2025-10-18)
- **Latest Available:** 13.15.15 (published 2025-05-28)
- **Impact:** 
  - isURL() uses '://' as protocol delimiter (browsers use ':')
  - Attackers can craft URLs bypassing protocol/domain validation
  - Leads to XSS and Open Redirect attacks
- **Status:** ‚ö†Ô∏è **VULNERABLE - NO FIX AVAILABLE**

**Dependency Chain:**
```
@sentry/nestjs ‚Üí @nestjs/common (peer) ‚Üí class-validator (peer) ‚Üí validator 13.15.15
```

**Mitigation Strategy:**
1. **Immediate:** Monitor validator.js repository for patch releases
2. **Short-term:** Review all isURL() usage in codebase for XSS risk
3. **Long-term:** Consider alternative validation library or custom implementation
4. **Tracking:** GitHub Advisory updated 2025-10-13 (check weekly)

---

### 3. IP Package Vulnerability (HIGH - UNMAINTAINED)

#### GHSA-2p57-rm9w-gvfp - isPublic() SSRF (HIGH)
- **CVE:** CVE-2024-29415
- **Severity:** 8.1 (High)
- **Affected Versions:** <= 2.0.1
- **Current Version:** 2.0.1 (via pnpm override)
- **Fix Version:** ‚ùå NONE - Package archived/unmaintained
- **Impact:**
  - isPublic() incorrectly categorizes private IPs as public
  - Examples: 127.1, 01200034567, ::fFFf:127.0.0.1
  - Enables SSRF attacks
- **Status:** ‚ö†Ô∏è **VULNERABLE - PACKAGE ABANDONED**

**Dependency Chain:**
```
@sentry/react-native ‚Üí react-native (peer) ‚Üí @react-native-community/cli ‚Üí ip 2.0.1
```

**Required Action:** 
- **Replace with:** `@webpod/ip@^0.6.1` (maintained fork)
- **Blocker:** Transitive dependency through react-native CLI
- **Solution:** Override in pnpm.overrides OR wait for react-native update

---

## Affected Workspace Packages

### Direct Dependencies
| Package | Vulnerable Library | Version | Status |
|---------|-------------------|---------|--------|
| Root (devDependencies) | axios | 1.12.2 | ‚úÖ SAFE |
| @money-wise/web | axios | 1.12.2 | ‚úÖ SAFE |
| Root (via @sentry/*) | validator | 13.15.15 | ‚ö†Ô∏è VULNERABLE |
| Root (via @sentry/react-native) | ip | 2.0.1 | ‚ö†Ô∏è VULNERABLE |

### Transitive Dependencies
- **validator:** Used by `class-validator@0.14.2` (peer dependency of NestJS)
- **ip:** Used by `@react-native-community/cli` (React Native tooling)

---

## Current pnpm Overrides

```json
"pnpm": {
  "overrides": {
    "ip": "^2.0.1",           // ‚ö†Ô∏è Still vulnerable - no fix exists
    "validator": "^13.15.15",  // ‚ö†Ô∏è Still vulnerable - no fix exists
    "axios": "^1.12.0"         // ‚úÖ Safe - covered by root dependencies
  }
}
```

**Override Status:**
- ‚úÖ **axios**: Overrides working correctly (version 1.12.2 is safe)
- ‚ö†Ô∏è **ip**: Override to latest, but latest version is still vulnerable
- ‚ö†Ô∏è **validator**: Override to latest, but latest version is still vulnerable

---

## Update Strategy & Recommendations

### Immediate Actions (0-7 Days)

1. **Axios - NO ACTION REQUIRED** ‚úÖ
   - Current version 1.12.2 fixes all 3 CVEs
   - Keep dependency updates enabled to stay current

2. **Validator - MONITORING REQUIRED** ‚ö†Ô∏è
   - **Action:** Add validator.js repository to security watch list
   - **Frequency:** Check weekly for patch release
   - **Link:** https://github.com/validatorjs/validator.js/releases
   - **Advisory:** https://github.com/advisories/GHSA-9965-vmph-33xx
   - **Code Audit:** Search codebase for isURL() usage and validate inputs

3. **IP Package - MIGRATION REQUIRED** ‚ö†Ô∏è
   - **Action:** Replace `ip` with `@webpod/ip`
   - **Method:** Update pnpm.overrides to force transitive dependency replacement
   - **Test:** Verify react-native CLI tools still function

### Short-Term Actions (1-2 Weeks)

#### IP Package Migration
```json
// package.json - Updated pnpm.overrides
"pnpm": {
  "overrides": {
    "ip": "npm:@webpod/ip@^0.6.1"  // Use npm: prefix for package replacement
  }
}
```

**Migration Steps:**
1. Update pnpm.overrides as shown above
2. Run `pnpm install --force` to regenerate lockfile
3. Test mobile development workflow (Expo, Metro bundler)
4. Verify react-native CLI commands work (run android/ios)
5. Run mobile test suite

**Compatibility Risk:** 
- LOW - @webpod/ip maintains API compatibility
- Test surface: React Native CLI tools (doctor, hermes)

#### Validator Code Audit
**Search for isURL usage:**
```bash
grep -r "isURL" apps/backend/src --include="*.ts"
grep -r "isURL" packages/ --include="*.ts"
```

**Audit Checklist:**
- [ ] Identify all isURL() usage in validation pipes
- [ ] Review URL sources (user input, API responses)
- [ ] Add additional validation layers for user-controlled URLs
- [ ] Consider custom URL validation with URL API + allowlist

### Long-Term Actions (1-3 Months)

1. **Validator Replacement Strategy**
   - **Option A:** Wait for official fix (monitor weekly)
   - **Option B:** Fork validator.js and apply community patches
   - **Option C:** Migrate to alternative (e.g., joi, yup, zod)
   - **Option D:** Custom URL validation implementation

2. **Dependency Health Monitoring**
   - Implement automated security scanning (Snyk/Socket/Dependabot)
   - Weekly review of security advisories
   - Quarterly dependency update cycles

---

## Compatibility Analysis

### Axios Update Impact
**From:** 1.12.2  
**To:** (no update needed - already safe)  
**Breaking Changes:** N/A  
**Peer Dependencies:** ‚úÖ No conflicts

### Validator Update Impact
**From:** 13.15.15  
**To:** (waiting for fix)  
**Current Override:** Already at latest  
**class-validator compatibility:** 
- Requires: `validator@^13.9.0`
- Current: 13.15.15 ‚úÖ Compatible
- Future: Monitor class-validator for updates

### IP Package Replacement Impact
**From:** ip@2.0.1  
**To:** @webpod/ip@0.6.1  
**Breaking Changes:** None (API compatible)  
**Affected Tools:**
- @react-native-community/cli-doctor
- @react-native-community/cli-hermes
- Both use ip.isPrivate() and ip.address() (maintained in @webpod/ip)

---

## Testing Strategy

### Pre-Update Testing
```bash
# Baseline - Current vulnerable state
pnpm test:ci                    # All test suites
pnpm dev:mobile                 # React Native Metro
npx react-native doctor         # RN CLI health check
```

### Post-Migration Testing (IP Replacement)
```bash
# After pnpm install --force
pnpm test:ci                    # Verify no regressions
pnpm dev:mobile                 # Test Metro bundler
npx react-native run-android    # Test Android toolchain
npx react-native run-ios        # Test iOS toolchain
npx react-native doctor         # CLI health check
```

### Validator Code Audit Testing
```bash
# After code changes
pnpm --filter @money-wise/backend test:unit    # Validation logic
pnpm --filter @money-wise/backend test:e2e     # API endpoint tests
```

---

## CI/CD Integration

### Dependabot Configuration
**Current:** Dependabot monitoring enabled  
**Action:** Verify alerts are being received

### GitHub Actions
**Recommended Addition:**
```yaml
# .github/workflows/security-audit.yml
name: Security Audit
on:
  schedule:
    - cron: '0 0 * * 1'  # Weekly Monday
  workflow_dispatch:

jobs:
  audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v2
      - run: pnpm audit --audit-level=moderate
      - run: pnpm outdated
```

---

## Decision Log

### Why Not Update Validator Now?
- ‚ùå No patched version exists (13.15.15 is latest and vulnerable)
- ‚úÖ pnpm.overrides already enforces latest version
- ‚è≥ Waiting for validator.js maintainers to release fix
- üìÖ Advisory published 2025-09-30, updated 2025-10-13

### Why Not Update IP Now?
- ‚ùå Package is archived/unmaintained (no official fix coming)
- ‚úÖ pnpm.overrides enforces 2.0.1 (latest but still vulnerable)
- ‚úÖ Alternative exists (@webpod/ip)
- ‚ö†Ô∏è Requires testing with React Native CLI

### Axios Already Fixed
- ‚úÖ Root package.json has axios@^1.12.2 (devDependencies)
- ‚úÖ @money-wise/web has axios@^1.12.0 (dependencies)
- ‚úÖ Both versions > minimum safe version (1.12.0)
- ‚úÖ pnpm.overrides ensures all transitive deps use safe version

---

## Next Steps (Priority Order)

### Priority 1: IP Package (HIGH Severity, Has Fix)
1. [ ] Update pnpm.overrides to use @webpod/ip
2. [ ] Run `pnpm install --force`
3. [ ] Test React Native development workflow
4. [ ] Verify mobile app builds successfully
5. [ ] Run mobile test suite
6. [ ] Commit and push to feature branch
7. [ ] Create PR with "security: replace unmaintained ip package" title

### Priority 2: Validator Monitoring (MEDIUM Severity, No Fix)
1. [ ] Star validator.js repository for release notifications
2. [ ] Subscribe to GHSA-9965-vmph-33xx advisory
3. [ ] Audit codebase for isURL() usage
4. [ ] Document isURL() usage locations
5. [ ] Add calendar reminder for weekly check (every Monday)
6. [ ] Evaluate alternative validation libraries (Zod, Yup)

### Priority 3: Documentation
1. [ ] Add this report to docs/development/security/
2. [ ] Update SECURITY.md with vulnerability handling process
3. [ ] Document decision to wait for validator fix
4. [ ] Add security monitoring to team runbook

---

## References

### GitHub Security Advisories
- [GHSA-4hjh-wcwx-xvwj](https://github.com/advisories/GHSA-4hjh-wcwx-xvwj) - Axios DoS
- [GHSA-jr5f-v2jv-69x6](https://github.com/advisories/GHSA-jr5f-v2jv-69x6) - Axios SSRF
- [GHSA-wf5p-g6vw-rhxx](https://github.com/advisories/GHSA-wf5p-g6vw-rhxx) - Axios CSRF
- [GHSA-9965-vmph-33xx](https://github.com/advisories/GHSA-9965-vmph-33xx) - Validator URL Bypass
- [GHSA-2p57-rm9w-gvfp](https://github.com/advisories/GHSA-2p57-rm9w-gvfp) - IP SSRF

### CVE References
- CVE-2025-58754 (Axios DoS)
- CVE-2025-27152 (Axios SSRF)
- CVE-2023-45857 (Axios CSRF)
- CVE-2025-56200 (Validator)
- CVE-2024-29415 (IP)

### Package Repositories
- [axios](https://github.com/axios/axios)
- [validator.js](https://github.com/validatorjs/validator.js)
- [ip](https://github.com/indutny/node-ip) - ‚ö†Ô∏è ARCHIVED
- [@webpod/ip](https://github.com/webpod/ip) - Maintained alternative

---

**Report Prepared By:** Claude AI Security Agent  
**Analysis Date:** 2025-10-18  
**Next Review:** 2025-10-25 (Weekly for validator.js updates)
