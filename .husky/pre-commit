#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# MoneyWise pre-commit hook
# Runs essential checks before allowing commit

echo "ğŸ” Running pre-commit checks..."

# Check if Prisma Client is generated (backend only)
if [ -d "apps/backend" ] && [ ! -d "apps/backend/generated/prisma" ]; then
  echo "  âš ï¸  Prisma Client not generated. Generating now..."
  cd apps/backend && pnpm prisma:generate && cd ../.. || {
    echo "âŒ Prisma Client generation failed."
    exit 1
  }
  echo "  âœ… Prisma Client generated"
fi

# Run linting
echo "  âœ¨ Linting..."
pnpm lint || {
  echo "âŒ Linting failed. Please fix errors and try again."
  exit 1
}

# Run type checking
echo "  ğŸ” Type checking..."
pnpm typecheck || {
  echo "âŒ Type checking failed. Please fix errors and try again."
  exit 1
}

# Run unit tests (fast)
echo "  ğŸ§ª Running unit tests..."
pnpm test:unit || {
  echo "âŒ Unit tests failed. Please fix failing tests and try again."
  exit 1
}

echo "âœ… Pre-commit checks passed!"