# M1.5 Execution Plan - Consolidate-Then-Promote Strategy

## ðŸŽ¯ EXECUTION OVERVIEW

**Start Date**: 2025-10-05
**Target Completion**: 2025-10-28 (4 weeks)
**Current Status**: Phase 1 - Fix Develop Blockers

---

## ðŸ“… DETAILED EXECUTION TIMELINE

### **PHASE 1: Fix Develop Branch Blockers** (Oct 5-6, 2 days)

#### Goals
- âœ… Green CI/CD on develop
- âœ… Unblock PR merges
- âœ… Prepare for M1.5 sprint work

#### Tasks

**TASK-PHASE1.1**: Enable CodeQL Code Scanning (2h)
```bash
# Step 1: Enable in GitHub Settings
# Navigate to: Settings â†’ Security â†’ Code security and analysis
# Click "Set up" next to "Code scanning"
# Select "Default" or "Advanced" setup
# Choose languages: JavaScript, TypeScript

# Step 2: Verify workflow permissions
# .github/workflows/security.yml already configured
# Permissions: security-events: write (already set)

# Step 3: Test workflow
gh workflow run security.yml --ref develop

# Step 4: Monitor results
gh run list --workflow=security.yml --branch develop --limit 1
gh run watch [run-id]
```

**Expected Result**:
- CodeQL Analysis (typescript): âœ… SUCCESS
- CodeQL Analysis (javascript): âœ… SUCCESS
- All CI/CD workflows GREEN

**Validation**:
```bash
# All workflows must pass
gh run list --branch develop --limit 3 --json conclusion,name

# Expected output:
# Progressive CI/CD Pipeline: success âœ…
# Security & Dependency Review: success âœ…
```

**Deliverables**:
- [ ] CodeQL enabled in repository settings
- [ ] Security workflow passing
- [ ] Documentation: `docs/development/codeql-setup.md`

**Assigned**: devops-specialist
**Story**: N/A (infrastructure fix)
**Estimated**: 2h
**Actual**: ___ h

---

### **PHASE 2: Complete EPIC-1.5 Stories** (Oct 5-26, 3 weeks)

#### Week 1 (Oct 5-11): Foundation Stories

**STORY-1.5.2**: Monitoring & Observability Integration (8 SP, 32h)
- [x] TASK-1.5.2.2: Configure Sentry environments âœ… COMPLETE
- [ ] TASK-1.5.2.11: Next.js App Router integration (4h)
- [ ] TASK-1.5.2.1: Backend health endpoints (4h)
- [ ] TASK-1.5.2.3: Environment variable audit (4h)
- [ ] TASK-1.5.2.4: Logging strategy (4h)
- [ ] TASK-1.5.2.5: Error tracking setup (4h)
- [ ] TASK-1.5.2.6: Performance monitoring (4h)
- [ ] TASK-1.5.2.7: Alert configuration (2h)
- [ ] TASK-1.5.2.8: Dashboard creation (2h)

**Branch**: `feature/story-1.5.2-sentry-environments` (current)
**Target PR**: Create when TASK-1.5.2.11 complete
**Status**: ðŸŸ¡ IN PROGRESS (10% complete)

---

**STORY-1.5.4**: Configuration Management Consolidation (5 SP, 44h)
- [ ] TASK-1.5.4.1: Audit configuration files (2h)
- [ ] TASK-1.5.4.2: Design unified strategy (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.4.3: Consolidate environment variables (8h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.4.4: Move secrets to GitHub Secrets (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.4.5: Configuration validation (4h)
- [ ] TASK-1.5.4.6: Create .env.example files (2h)
- [ ] TASK-1.5.4.7: Update Docker Compose (4h)
- [ ] TASK-1.5.4.8: Document configuration (2h)
- [ ] TASK-1.5.4.9: Add to CI/CD (4h)
- [ ] TASK-1.5.4.10: Test across environments (2h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.4.11: Configuration quality gate (2h) ðŸ”´ CRITICAL
- [ ] **TASK-1.5.4.12**: Security dependency remediation (4h) ðŸ”´ NEW

**Branch**: Create `feature/story-1.5.4-config-consolidation`
**Dependencies**: None (can parallelize with STORY-1.5.2)
**Status**: ðŸ“‹ BACKLOG

---

**STORY-1.5.1**: Code Quality & Architecture Cleanup (3 SP, 24h)
- [ ] TASK-1.5.1.1: Eliminate process.env violations (8h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.1.2: TypeScript strict mode (4h)
- [ ] TASK-1.5.1.3: ESLint rule enforcement (4h)
- [ ] TASK-1.5.1.4: Code smells refactoring (4h)
- [ ] TASK-1.5.1.5: Architecture documentation (4h)

**Branch**: Create `feature/story-1.5.1-code-quality`
**Dependencies**: STORY-1.5.4 (process.env depends on config consolidation)
**Status**: ðŸ“‹ BACKLOG

---

#### Week 2 (Oct 12-18): Documentation & Organization

**STORY-1.5.3**: Documentation Consolidation (5 SP, 40h)
- [ ] TASK-1.5.3.1: Audit documentation files (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.3.2: Create ADR framework (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.3.3: Write 12 formal ADRs (16h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.3.4: Consolidate scattered docs (8h)
- [ ] TASK-1.5.3.5: Create doc navigation (4h)
- [ ] TASK-1.5.3.6: Documentation quality gate (4h) ðŸ”´ CRITICAL

**Branch**: Create `feature/story-1.5.3-documentation`
**Dependencies**: None
**Status**: ðŸ“‹ BACKLOG

---

**STORY-1.5.5**: .claude/ Directory Cleanup (3 SP, 24h)
- [ ] TASK-1.5.5.1: Audit .claude/ structure (2h)
- [ ] TASK-1.5.5.2: Reorganize agents (4h)
- [ ] TASK-1.5.5.3: Consolidate orchestration (4h)
- [ ] TASK-1.5.5.4: Archive obsolete files (2h)
- [ ] TASK-1.5.5.5: Update references (4h)
- [ ] TASK-1.5.5.6: Create maintenance docs (4h)
- [ ] TASK-1.5.5.7: Validate workflow (4h)

**Branch**: Create `feature/story-1.5.5-claude-cleanup`
**Dependencies**: None
**Status**: ðŸ“‹ BACKLOG

---

#### Week 3 (Oct 19-26): Testing & Structure

**STORY-1.5.6**: Project Structure Optimization (5 SP, 40h)
- [ ] TASK-1.5.6.1: Audit project structure (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.6.2: Optimize directory layout (8h)
- [ ] TASK-1.5.6.3: Update import paths (8h)
- [ ] TASK-1.5.6.4: Consolidate shared code (8h)
- [ ] TASK-1.5.6.5: Update build configs (4h)
- [ ] TASK-1.5.6.6: Validate all apps (4h)
- [ ] TASK-1.5.6.7: Update documentation (4h)

**Branch**: Create `feature/story-1.5.6-project-structure`
**Dependencies**: STORY-1.5.1 (code must be clean first)
**Status**: ðŸ“‹ BACKLOG

---

**STORY-1.5.7**: Testing Infrastructure Hardening (8 SP, 82h)
- [ ] TASK-1.5.7.1: Audit test coverage (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.7.2: Set coverage thresholds (2h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.7.3: Write unit tests (16h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.7.4: Write integration tests (16h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.7.5: E2E tests (16h)
- [ ] TASK-1.5.7.6: Test data factories (8h)
- [ ] TASK-1.5.7.7: Performance benchmarks (8h)
- [ ] TASK-1.5.7.8: Visual regression tests (8h)
- [ ] TASK-1.5.7.9: Mutation testing (4h)
- [ ] TASK-1.5.7.10: Test database isolation (4h)
- [ ] TASK-1.5.7.11: Test utilities (4h)
- [ ] TASK-1.5.7.12: Testing documentation (4h)
- [ ] TASK-1.5.7.13: CI quality gates (4h) ðŸ”´ CRITICAL
- [ ] TASK-1.5.7.14: Optimize test performance (4h)
- [ ] TASK-1.5.7.15: Testing quality gate (4h) ðŸ”´ CRITICAL
- [ ] **TASK-1.5.7.16**: Configure CodeQL (2h) ðŸ”´ NEW

**Branch**: Create `feature/story-1.5.7-testing-hardening`
**Dependencies**: STORY-1.5.1 (code must be clean first)
**Status**: ðŸ“‹ BACKLOG

---

### **PHASE 3: Consolidated Validation** (Oct 27, 1 day)

#### Goal: Comprehensive QA on develop branch

**Validation Checklist**:

**Step 1: Automated Testing** (2h)
```bash
# Run full test suite
pnpm lint                  # Expected: âœ… 0 errors
pnpm typecheck            # Expected: âœ… 0 errors
pnpm test:unit            # Expected: âœ… â‰¥90% coverage
pnpm test:integration     # Expected: âœ… All passing
pnpm test:e2e            # Expected: âœ… All critical flows
pnpm build               # Expected: âœ… All apps + packages build
```

**Step 2: CI/CD Validation** (1h)
```bash
# Verify all workflows GREEN
gh run list --branch develop --limit 5

# Expected:
# Progressive CI/CD Pipeline: success âœ…
# Security & Dependency Review: success âœ…
# Sentry Release Management: success/skipped âœ…
```

**Step 3: Security Validation** (1h)
```bash
# CodeQL scan
gh api /repos/kdantuono/money-wise/code-scanning/alerts \
  --jq '.[] | select(.state == "open")'
# Expected: 0 critical alerts

# Dependabot (on develop)
gh api /repos/kdantuono/money-wise/dependabot/alerts \
  --jq '.[] | select(.state == "open" and .security_advisory.severity == "critical")'
# Expected: 0 critical alerts (develop has Next.js 15.2.4)
```

**Step 4: Manual Validation** (2h)
```bash
# Start local development
docker compose -f docker-compose.dev.yml up -d
pnpm dev:backend &
pnpm dev:web &

# Health checks
curl http://localhost:3001/api/health
# Expected: {"status":"ok","database":"connected","redis":"connected"}

# Frontend validation
open http://localhost:3000
# Expected: Homepage renders without errors

# Authentication flow
# Test: Register â†’ Login â†’ Dashboard
# Expected: All flows working

# Database migrations
pnpm db:migrate
# Expected: All migrations applied successfully
```

**Deliverables**:
- [ ] All automated tests passing
- [ ] All CI/CD workflows GREEN
- [ ] Security scans passing (0 critical)
- [ ] Manual validation complete
- [ ] Validation report: `docs/development/m1.5-validation-report.md`

**Assigned**: qa-testing-engineer
**Estimated**: 6h
**Approval Required**: YES (user must sign off)

---

### **PHASE 4: Production Promotion** (Oct 28, 1 day)

#### Goal: Deploy M1.5 consolidated codebase to production

**Step 1: Create Release Branch** (30 min)
```bash
git checkout main
git pull origin main
git checkout -b release/v0.5.0-m1.5-consolidation
git merge develop --no-ff

# If conflicts (unlikely):
# Resolve manually, prioritizing develop changes
# git commit

git push -u origin release/v0.5.0-m1.5-consolidation
```

**Step 2: Create Release PR** (30 min)
```bash
gh pr create --base main --head release/v0.5.0-m1.5-consolidation \
  --title "[RELEASE] v0.5.0 - Milestone 1.5 Consolidation Complete" \
  --body "$(cat <<'EOF'
## Milestone 1.5: Technical Debt & Infrastructure Consolidation

### Summary

Complete consolidation of M1 foundation work with comprehensive technical debt remediation, security hardening, and quality improvements.

### Changes

**Security**:
- âœ… Next.js 14.0.3 â†’ 15.2.4 (resolves 27/31 Dependabot alerts)
- âœ… ip, semver, esbuild overrides enforced
- âœ… CodeQL code scanning enabled
- âœ… Sentry error tracking integrated (backend + frontend)

**Technical Debt**:
- âœ… 67 process.env violations eliminated
- âœ… 7 .env files consolidated to unified configuration
- âœ… Documentation: 3822 â†’ <500 organized files
- âœ… 12 formal ADRs established

**Quality**:
- âœ… Test coverage: â‰¥90%
- âœ… All CI/CD pipelines GREEN
- âœ… Code quality metrics met
- âœ… Performance benchmarks established

### Validation

See: `docs/development/m1.5-validation-report.md`

### Stories Completed

- [x] STORY-1.5.1: Code Quality & Architecture Cleanup (#103)
- [x] STORY-1.5.2: Monitoring & Observability Integration (#104)
- [x] STORY-1.5.3: Documentation Consolidation & Architecture (#105)
- [x] STORY-1.5.4: Configuration Management Consolidation (#106)
- [x] STORY-1.5.5: .claude/ Directory Cleanup & Organization (#107)
- [x] STORY-1.5.6: Project Structure Optimization (#108)
- [x] STORY-1.5.7: Testing Infrastructure Hardening (#109)

### Breaking Changes

None - backward compatible

### Deployment Notes

- Database migrations: Run `pnpm db:migrate` before deployment
- Environment variables: Update per `docs/development/sentry-configuration.md`
- Sentry DSN: Required for error tracking (optional but recommended)

### References

- Deployment Strategy: `docs/development/deployment-strategy-m1.5.md`
- Execution Plan: `docs/development/m1.5-execution-plan.md`
- EPIC-1.5: #102

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
EOF
)"
```

**Step 3: CI/CD Validation** (1h)
```bash
# Wait for CI/CD to complete
gh pr checks release/v0.5.0-m1.5-consolidation --watch

# Expected: All checks passing
```

**Step 4: Code Review** (2h)
- Manual review of CHANGELOG.md
- Review breaking changes (should be none)
- Verify all stories marked complete
- Approval from user (kdantuono)

**Step 5: Merge to Main** (15 min)
```bash
# After approval
gh pr merge release/v0.5.0-m1.5-consolidation --merge \
  --body "Milestone 1.5 consolidation complete - production ready"

# Verify merge
git checkout main
git pull origin main
git log --oneline -5
```

**Step 6: Tag Release** (15 min)
```bash
git tag -a v0.5.0 -m "$(cat <<'EOF'
Milestone 1.5: Technical Debt & Infrastructure Consolidation

Major improvements:
- Security: Next.js 15.2.4, 27/31 alerts resolved
- Quality: â‰¥90% test coverage, all CI/CD GREEN
- Technical Debt: -60% (process.env, configs, docs)
- Monitoring: Sentry integration complete
- Documentation: 12 ADRs, consolidated structure

Full changelog: CHANGELOG.md
EOF
)"

git push origin v0.5.0
```

**Step 7: Verify Dependabot** (15 min)
```bash
# Check Dependabot alerts on main
gh api /repos/kdantuono/money-wise/dependabot/alerts \
  --jq '.[] | {number, state, severity: .security_advisory.severity}'

# Expected: 27/31 alerts auto-closed
# Remaining 4: Dev-only dependencies (low priority)
```

**Step 8: Create GitHub Release** (15 min)
```bash
gh release create v0.5.0 \
  --title "v0.5.0 - Milestone 1.5 Consolidation" \
  --notes-file docs/development/m1.5-release-notes.md \
  --latest

# Attach artifacts (optional)
# gh release upload v0.5.0 coverage-reports/lcov.info
```

**Deliverables**:
- [ ] Release PR created and merged
- [ ] v0.5.0 tag created
- [ ] GitHub release published
- [ ] Dependabot alerts: 31 â†’ 4 (27 resolved)
- [ ] Production deployment successful

**Assigned**: devops-engineer
**Estimated**: 4h
**Approval Required**: YES (user must approve PR merge)

---

## ðŸ“‹ DAILY WORKFLOW

### For Each Story

1. **Start Work**:
   ```bash
   # Move story to "In Progress" on board
   gh project item-edit --id [ITEM_ID] --field-id Status --text "In Progress"

   # Create feature branch
   git checkout develop
   git pull origin develop
   git checkout -b feature/story-X.X.X-description
   ```

2. **During Work**:
   - Complete tasks sequentially
   - Commit frequently with conventional commits
   - Run tests before committing: `pnpm lint && pnpm typecheck && pnpm test`

3. **Create PR**:
   ```bash
   git push -u origin feature/story-X.X.X-description

   gh pr create --base develop --head feature/story-X.X.X-description \
     --title "feat(scope): Story X.X.X - Description" \
     --body "Closes #XXX (story issue)"
   ```

4. **After Merge**:
   ```bash
   # Move story to "Done" on board
   gh project item-edit --id [ITEM_ID] --field-id Status --text "Done"

   # Delete feature branch
   git branch -d feature/story-X.X.X-description
   git push origin --delete feature/story-X.X.X-description
   ```

### Weekly Progress Check (Every Friday)

```bash
# Run board status script
.claude/scripts/board-status.sh list | grep "STORY-1.5"

# Expected output shows progress:
# STORY-1.5.1 | Status: Done
# STORY-1.5.2 | Status: In Progress
# etc.

# Review with user:
# - Stories completed this week
# - Blockers/issues
# - Plan for next week
```

---

## ðŸš¦ GO/NO-GO DECISION POINTS

### Week 1 Check (Oct 12)
**Criteria**:
- [ ] STORY-1.5.2 complete
- [ ] STORY-1.5.4 complete or 80% done
- [ ] CodeQL passing
- [ ] No critical blockers

**Decision**: Continue to Week 2 OR adjust timeline

### Week 2 Check (Oct 19)
**Criteria**:
- [ ] 4/7 stories complete
- [ ] All CI/CD GREEN
- [ ] No security regressions

**Decision**: Continue to Week 3 OR add buffer time

### Week 3 Check (Oct 26)
**Criteria**:
- [ ] 7/7 stories complete
- [ ] All acceptance criteria met
- [ ] Ready for Phase 3 validation

**Decision**: Proceed to validation OR extend sprint

### Final Gate (Oct 27)
**Criteria**:
- [ ] Phase 3 validation complete
- [ ] User approval obtained
- [ ] No critical issues

**Decision**: GO for production promotion

---

## ðŸ“ž ESCALATION PATHS

### Issue Severity Levels

**BLOCKER** ðŸ”´:
- All development stopped
- Immediate user notification
- Example: Main branch security exploit discovered

**CRITICAL** ðŸŸ :
- Delays timeline by >1 day
- User notification within 4 hours
- Example: Story dependency not met

**HIGH** ðŸŸ¡:
- May delay timeline
- User notification within 1 day
- Example: Scope creep on story

**MEDIUM/LOW** ðŸŸ¢:
- Normal progress
- Update in weekly check
- Example: Minor refactoring needed

---

## âœ… SUCCESS CRITERIA

### EPIC-1.5 Complete When:
- [ ] All 7 stories in "Done" status
- [ ] All 89+ tasks complete
- [ ] Technical debt reduced by 60%
- [ ] Test coverage â‰¥90%
- [ ] All CI/CD GREEN
- [ ] 0 critical security vulnerabilities
- [ ] User approval obtained

### Production Promotion Complete When:
- [ ] v0.5.0 released
- [ ] Main branch updated
- [ ] Dependabot: 27/31 alerts resolved
- [ ] Production deployment successful
- [ ] No rollback needed within 24h

---

**Document Owner**: kdantuono (User) + Claude Code (AI Assistant)
**Execution Type**: Agile Sprint Plan
**Timeline**: 4 weeks (Oct 5 - Nov 1)
**Status**: ACTIVE
**Last Updated**: 2025-10-05
**Next Update**: 2025-10-12 (Week 1 check)
