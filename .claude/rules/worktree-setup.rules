# Git Worktree Setup Rules

## MANDATORY: Environment File Propagation

When creating a new git worktree, `.env` files are NOT copied because they are in `.gitignore`.

### Critical Rule

**EVERY TIME a worktree is created, you MUST copy environment files from main:**

```bash
# After creating worktree
git worktree add /path/to/worktree branch-name

# MANDATORY: Copy environment files
cp /home/nemesi/dev/money-wise/apps/backend/.env /path/to/worktree/apps/backend/.env
cp /home/nemesi/dev/money-wise/apps/web/.env.local /path/to/worktree/apps/web/.env.local 2>/dev/null || true

# Also copy root .env if exists
cp /home/nemesi/dev/money-wise/.env /path/to/worktree/.env 2>/dev/null || true
```

### Why This Matters

1. `.env` files contain secrets (API keys, credentials)
2. Git excludes them via `.gitignore` for security
3. Worktrees only get **tracked** files
4. Without this step, worktrees use empty/example credentials

### Files That Need Copying

| Source | Destination | Contains |
|--------|-------------|----------|
| `apps/backend/.env` | worktree/apps/backend/.env | SaltEdge credentials, DB config, JWT secrets |
| `apps/web/.env.local` | worktree/apps/web/.env.local | Frontend API URLs, feature flags |
| `.env` (root) | worktree/.env | Shared config (if any) |

### Verification After Copy

```bash
# Verify SaltEdge credentials are present
grep "SALTEDGE_APP_ID" /path/to/worktree/apps/backend/.env

# Should output:
# SALTEDGE_APP_ID=wuQhPpSwSDYfa4WceLhSt0FJ2q1Qd_4tO1DPRROOXNQ
```

### Quick Setup Script

Use the provided script for automated setup:
```bash
./.claude/scripts/setup-worktree-env.sh /path/to/worktree
```

## Current SaltEdge Credentials

- **Environment**: Sandbox (testing)
- **APP_ID**: wuQhPpSwSDYfa4WceLhSt0FJ2q1Qd_4tO1DPRROOXNQ
- **SECRET**: cp19Wvsmex1zBh_3cRDGVJlQh5HjRXbm4ufTRAfgSNI
- **PRIVATE_KEY_PATH**: /home/nemesi/saltedge_private.pem

These are stored in `/home/nemesi/dev/money-wise/apps/backend/.env` (main worktree).

**Note**: The RSA private key at `/home/nemesi/saltedge_private.pem` is required for SaltEdge v6 API request signing. This file is NOT in the repo (it's in the user's home directory), so it doesn't need copying - just ensure `SALTEDGE_PRIVATE_KEY_PATH` points to the correct absolute path.

---

## Agent Instructions Strategy

**IMPORTANT**: PR-specific agent instructions should be created IN THE WORKTREE, not in main.

### Convention

```
<worktree>/.AGENT-INSTRUCTIONS.md    # Dot-prefix = local, not committed
```

### Why Worktree-Local Instructions?

1. **Auto-cleanup**: Deleted when worktree is removed
2. **No pollution**: Main worktree stays clean
3. **Isolation**: Each agent sees only its task
4. **No commits**: Instructions are local working context

### Orchestrator Access

The orchestrator (in main worktree) can still read instructions:
```bash
cat /home/nemesi/dev/money-wise-dashboard/.AGENT-INSTRUCTIONS.md
cat /home/nemesi/dev/money-wise-budget/.AGENT-INSTRUCTIONS.md
```

### Active Work Tracking

Use the TODO list (persisted in `~/.claude/todos/`) to track active agents.
No need for tracking files in `.claude/orchestration/`.

---
*Rule Version: 1.1.0 | Updated: 2024-11-29 - Added agent instructions strategy*
