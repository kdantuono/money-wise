# Agent Selection Matrix Configuration
version: 1.0.0

patterns:
  # Architecture Design
  architecture_design:
    keywords: [architecture, design, scalability, pattern, adr, microservices, system]
    required_agents:
      - architect
    optional_agents:
      - backend-specialist
      - database-specialist

  # Epic/Story Management
  epic_management:
    keywords: [epic, story, stories, decompose, breakdown, planning]
    required_agents:
      - orchestrator
      - product-manager
    optional_agents: []

  # Backend Development
  backend_development:
    keywords: [api, endpoint, backend, service, controller, middleware, nestjs]
    required_agents:
      - backend-specialist
    optional_agents:
      - database-specialist
      - test-specialist

  # Frontend Development  
  frontend_development:
    keywords: [ui, component, frontend, react, next, page, dashboard, view]
    required_agents:
      - frontend-specialist
    optional_agents:
      - test-specialist

  # Database Operations
  database_operations:
    keywords: [migration, schema, database, sql, query, index, typeorm, prisma]
    required_agents:
      - database-specialist
    optional_agents:
      - backend-specialist

  # Testing
  testing:
    keywords: [test, testing, coverage, e2e, unit, integration, jest, playwright]
    required_agents:
      - test-specialist
    optional_agents: []

  # Security
  security_audit:
    keywords: [security, vulnerability, auth, authentication, authorization, jwt, owasp]
    required_agents:
      - security-specialist
    optional_agents:
      - backend-specialist

  # DevOps
  deployment:
    keywords: [deploy, deployment, ci, cd, pipeline, docker, production, staging]
    required_agents:
      - devops-specialist
    optional_agents:
      - test-specialist

  # Bug Fixing
  bug_fixing:
    keywords: [bug, fix, issue, problem, error, broken, debug]
    analyze_domain: true  # Determines agents based on affected code
    fallback_agents:
      - test-specialist

# Agent Pool Configuration
agent_pools:
  architect:
    max_instances: 1
    stateless: false  # Maintains architecture decisions
    memory_limit: 64000  # Extra memory for ADR + decision history
    priority: critical
    session_persistence: true  # Cross-session memory
    state_backup: enabled     # Decision recovery
    decision_store: filesystem # ADR persistence
    conflict_resolution: block # Prevents contradictory decisions

  backend-specialist:
    max_instances: 3
    stateless: true
    memory_limit: 32000
    
  frontend-specialist:
    max_instances: 2
    stateless: true
    memory_limit: 32000
    
  database-specialist:
    max_instances: 1
    stateless: false  # Maintains schema knowledge
    memory_limit: 32000
    
  test-specialist:
    max_instances: 3
    stateless: true
    memory_limit: 32000
    
  security-specialist:
    max_instances: 1
    stateless: true
    memory_limit: 32000
    
  orchestrator:
    max_instances: 1
    stateless: false  # Maintains epic state
    memory_limit: 64000
    
  product-manager:
    max_instances: 1
    stateless: true
    memory_limit: 32000
    
  devops-specialist:
    max_instances: 1
    stateless: false  # Maintains deployment state
    memory_limit: 32000

# Dependency Rules
dependencies:
  backend_requires: [database-specialist]
  frontend_requires: []
  deployment_requires: [test-specialist, security-specialist]
  epic_requires: [all]
  architecture_requires: [architect]  # Architecture decisions need architect

# MoneyWise Financial Domain Governance
financial_governance:
  architect:
    security_first: true        # Security decisions have precedence
    compliance_tracking: true   # PCI/SOX decision audit trail
    mvp_to_scale_path: true    # Remember evolution planning
    adr_template: enabled      # Structured Architecture Decision Records
    review_triggers:           # When to escalate decisions
      - major_technology_change
      - security_pattern_change
      - scalability_threshold
    delegation_rules:          # What can be delegated to specialists
      implementation_details: true
      pattern_applications: true
      technology_research: false
      architecture_decisions: false